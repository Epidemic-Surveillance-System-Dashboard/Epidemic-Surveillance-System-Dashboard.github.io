(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{209:function(e,t,a){e.exports=a(448)},214:function(e,t,a){},234:function(e,t,a){},306:function(e,t,a){},339:function(e,t,a){},441:function(e,t,a){},446:function(e,t,a){},448:function(e,t,a){"use strict";a.r(t);var n=a(1),r=a.n(n),o=a(9),s=a.n(o),i=(a(214),a(216),a(206)),l=(a(450),a(47)),c=(a(93),a(8)),u=a(27),d=a.n(u),p=a(38),h=a(18),f=a(19),m=a(21),g=a(20),y=a(22),v=(a(230),a(92)),b=a(455),E=a(453),D=a(454),w=(a(50),a(15)),S=(a(51),a(11)),L=(a(44),a(16)),M=(a(234),function(e){function t(){var e,a;Object(h.a)(this,t);for(var n=arguments.length,o=new Array(n),s=0;s<n;s++)o[s]=arguments[s];return(a=Object(m.a)(this,(e=Object(g.a)(t)).call.apply(e,[this].concat(o)))).rightButtonRenderer=function(){return null!=a.props.rightButtonAction&&null!=a.props.rightButtonType?r.a.createElement(L.a,{type:"default",onClick:a.props.rightButtonAction,className:"ghost-button"},r.a.createElement(c.a,{className:"trigger",type:a.props.rightButtonType?a.props.rightButtonType:"menu-fold"})):null},a}return Object(y.a)(t,e),Object(f.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"navMenu"},r.a.createElement(w.a,null,r.a.createElement(S.a,{span:4},r.a.createElement(L.a,{type:"default",onClick:this.props.openDrawer_f,className:"ghost-button"},r.a.createElement(c.a,{className:"trigger",type:"menu-unfold"}))),r.a.createElement(S.a,{span:16},r.a.createElement("h2",{className:"nowrap center"},this.props.title)),r.a.createElement(S.a,{span:4},this.rightButtonRenderer())))}}]),t}(n.Component)),I=(a(71),a(33)),k=(a(191),a(48)),O=(a(101),a(40)),T=(a(192),a(119)),C=(a(144),a(306),a(86),a(62)),N=(a(99),a(61)),A=a(29),j=["#2980b9","#27ae60","#ef8717","#7f8c8d"],x="#e74c3c",V=0,G=["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"],U=function(e){function t(){var e,a;Object(h.a)(this,t);for(var n=arguments.length,o=new Array(n),s=0;s<n;s++)o[s]=arguments[s];return(a=Object(m.a)(this,(e=Object(g.a)(t)).call.apply(e,[this].concat(o)))).getNextColor=function(){var e=j[V];return V=(V+1)%j.length,e},a.resetColor=function(){V=0},a.startDate=null,a.mockMetric={name:"Male Vaccinations Ages 0-19",location:{state:"Ex",lga:"Ex",ward:"Ex",facility:"Ex"},data:[{Month:"JAN",Year:2017,Value:Math.floor(10*Math.random())},{Month:"FEB",Year:2017,Value:Math.floor(10*Math.random())},{Month:"MAR",Year:2017,Value:Math.floor(10*Math.random())},{Month:"APR",Year:2017,Value:Math.floor(10*Math.random())},{Month:"MAY",Year:2017,Value:Math.floor(10*Math.random())},{Month:"JUN",Year:2017,Value:Math.floor(10*Math.random())},{Month:"JUL",Year:2017,Value:Math.floor(10*Math.random())},{Month:"AUG",Year:2017,Value:Math.floor(10*Math.random())},{Month:"SEP",Year:2017,Value:Math.floor(10*Math.random())},{Month:"OCT",Year:2017,Value:Math.floor(10*Math.random())},{Month:"NOV",Year:2017,Value:Math.floor(10*Math.random())},{Month:"DEC",Year:2017,Value:Math.floor(10*Math.random())},{Month:"JAN",Year:2018,Value:Math.floor(10*Math.random())},{Month:"FEB",Year:2018,Value:Math.floor(10*Math.random())},{Month:"MAR",Year:2018,Value:Math.floor(10*Math.random())},{Month:"APR",Year:2018,Value:Math.floor(10*Math.random())},{Month:"MAY",Year:2018,Value:Math.floor(10*Math.random())},{Month:"JUN",Year:2018,Value:Math.floor(10*Math.random())},{Month:"JUL",Year:2018,Value:Math.floor(10*Math.random())},{Month:"AUG",Year:2018,Value:Math.floor(10*Math.random())},{Month:"SEP",Year:2018,Value:Math.floor(10*Math.random())},{Month:"OCT",Year:2018,Value:Math.floor(10*Math.random())},{Month:"NOV",Year:2018,Value:Math.floor(10*Math.random())},{Month:"DEC",Year:2018,Value:Math.floor(10*Math.random())}]},a.mockSet={name:"Male Vaccinations",startDate:"",endDate:"",location:{state:"Ex",lga:"Ex",ward:"Ex",facility:"Ex"},data:[{Value:Math.floor(10*Math.random()),Metric:"Male Vaccinations 0-10"},{Value:Math.floor(10*Math.random()),Metric:"Male Vaccinations 10-40"},{Value:Math.floor(10*Math.random()),Metric:"Male Vaccinations 40-80"},{Value:Math.floor(10*Math.random()),Metric:"Male Vaccinations 80+"}]},a.mockGroup={data:[[{Value:1,Metric:"Metric1"},{Value:2,Metric:"Metric2"},{Value:3,Metric:"Metric3"},{Value:4,Metric:"Metric4"}],[{Value:2,Metric:"Metric1"},{Value:3,Metric:"Metric2"},{Value:4,Metric:"Metric3"},{Value:5,Metric:"Metric4"}],[{Value:3,Metric:"Metric1"},{Value:4,Metric:"Metric2"},{Value:5,Metric:"Metric3"},{Value:6,Metric:"Metric4"}]],legendTitles:["Location 1","Location 2","Location 3"]},a.createBarSeriesData=function(e){var t=a.getNextColor(),n=e.data.map(function(e){return{y:e.Metric,x:e.Value}});return{barSeries:r.a.createElement(A.c,{data:n,color:t}),legend:r.a.createElement(A.a,{orientation:"horizontal",items:[{title:e.name,color:t},{title:"Average",color:x}]})}},a.createBarSeriesAverage=function(e){for(var t=0,a=0,n=0;n<e.data.length;n++)t+=e.data[n].Value,a++;var o=a>0?t/a:0,s=e.data.map(function(e){return{y:e.Metric,x:o}});return r.a.createElement(A.f,{data:s,strokeDasharray:[7,5],color:x})},a.renderGraph=function(){var e=null;switch(a.props.type){case"Group":e=a.MultipleBar();break;case"Set":e=a.Histogram();break;case"Metric":e=a.Line();break;default:e=null}return e},a.defaults={width:350,height:350,xDistance:100,barChartLeftMargin:175},a}return Object(y.a)(t,e),Object(f.a)(t,[{key:"createMultipleBarSeries",value:function(){for(var e=this.props.data.data||this.mockGroup.data,t=0,a=0;a<e.length;a++)for(var n=0;n<e.length;n++)e[a][n].Metric.length>t&&(t=e[a][n].Metric.length);this.defaults.barChartLeftMargin=Math.round(5.5*t+20,0);for(var o={barSeries:[],legend:null,lineData:null},s=0;s<e.length;s++){for(var i=[],l=0;l<e[s].length;l++)i.push({y:e[0][l].Metric,x:e[s][l].Value});o.barSeries.push(r.a.createElement(A.c,{key:s,data:i,color:this.getNextColor()}))}this.resetColor(),console.log(this.props.data.legendTitles);for(var c=[],u=0;u<this.props.data.legendTitles.length;u++)c.push({title:this.props.data.legendTitles[u],color:this.getNextColor()});return o.legend=r.a.createElement(A.a,{orientation:"horizontal",items:c}),o}},{key:"MultipleBar",value:function(){var e=this.createMultipleBarSeries();return r.a.createElement("div",{className:"center"},r.a.createElement(A.b,{yType:"ordinal",height:this.defaults.height,margin:{left:this.defaults.barChartLeftMargin}},r.a.createElement(A.d,null),r.a.createElement(A.h,null),r.a.createElement(A.i,null),e.barSeries),e.legend)}},{key:"createHistogramData",value:function(){var e=this.props.data;if(console.log(e),0===e.length)return null;for(var t=0,a=0;a<e.data.length;a++)(""+e.data[a].Metric).length>t&&(t=(""+e.data[a].Metric).length);this.defaults.barChartLeftMargin=Math.round(5.5*t+20,0);var n=this.createBarSeriesData(e);return{barSeries:n.barSeries,legend:n.legend,averageLine:this.createBarSeriesAverage(e)}}},{key:"Histogram",value:function(){var e=this.createHistogramData();return console.log(e),null===e?r.a.createElement("div",null,"empty"):r.a.createElement("div",{className:"center"},r.a.createElement(A.b,{yType:"ordinal",height:this.defaults.height,margin:{left:this.defaults.barChartLeftMargin}},r.a.createElement(A.d,null),r.a.createElement(A.g,null),r.a.createElement(A.h,null),r.a.createElement(A.i,null),e.barSeries,e.averageLine),e.legend)}},{key:"createLineSeriesWithLegend",value:function(){var e={legend:null,series:[]},t=[],a=[],n=0,o=0,s=this.props.data.data||this.mockMetric.data;if(0===s.length)return null;!1===s[0].hasOwnProperty("Date")&&(s.forEach(function(e){e.Date=new Date(e.Time),e.Value=Number.parseInt(e.Value)}),s.sort(function(e,t){return e.Date-t.Date}));for(var i=null,l=[],c=0;c<G.length;c++)l.push({x:G[c],y:0});var u=r.a.createElement(A.e,{key:-1,data:l,color:"transparent",colorType:"literal"});e.series.push(u);for(var d=0;d<s.length;d++)if(null===i&&(i=s[d].Date.getUTCFullYear()),t.push({x:G[s[d].Date.getUTCMonth()],y:s[d].Value}),n+=s[d].Value,o++,d===s.length-1||s[d+1].Date.getUTCFullYear()!==i){var p=this.getNextColor();e.series.push(r.a.createElement(A.e,{key:d,data:t,color:p,colorType:"literal"}));var h="".concat(i);a.push({title:h,color:p}),t=[],d!==s.length-1&&(i=s[d+1].Date.getUTCFullYear())}for(var f=[],m=o>0?n/o:0,g=0;g<G.length;g++)f.push({x:G[g],y:m});a.push({title:"Average",color:x}),e.series.push(r.a.createElement(A.f,{key:e.length+1,data:f,strokeDasharray:[7,5],color:x,colorType:"literal"}));var y=r.a.createElement(A.a,{orientation:"horizontal",items:a});return e.legend=y,e}},{key:"Line",value:function(){var e=this.createLineSeriesWithLegend();return null===e?r.a.createElement("div",{className:"graphPlaceholder"},r.a.createElement(C.a,{description:"Hmm.. we can't find any data"})):r.a.createElement("div",{className:"center"},r.a.createElement(A.b,{xType:"ordinal",height:this.defaults.height},r.a.createElement(A.d,null),r.a.createElement(A.g,null),r.a.createElement(A.h,null),r.a.createElement(A.i,null),e.series),e.legend)}},{key:"render",value:function(){var e=this;if(!1===this.props.show)return null;V=0,Object.keys(this.defaults).forEach(function(t){void 0!==e.props[t]&&(e.defaults[t]=e.props[t])});var t=this.renderGraph();return null!==t?r.a.createElement("div",null,t," ",r.a.createElement("span",null)):r.a.createElement("div",null,"Sorry, something went wrong.")}}]),t}(n.Component),F=new(a(195).a)("ESSD_DB");F.version(1).stores({Facility:"Id,parentId",Ward:"Id,parentId",LGA:"Id,parentId",State:"Id",Groups:"Id",Sets:"Id,parentId",Metrics:"Id,parentId",Data:"Id,Time,MetricId,FacilityId,[FacilityId+MetricId+Time]",User:"Id",LocalUser:"Id",Dashboard:"Id",DashboardData:"Id"});var P=F,H=function(e){function t(){var e,a;Object(h.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(m.a)(this,(e=Object(g.a)(t)).call.apply(e,[this].concat(r)))).state={ready:!1,data:null},a.checkInputs=function(){console.log(a.state);var e=!0,t={LocationId:function(e){return void 0!==e&&null!==e},LocationType:function(e){return["National","State","LGA","Ward","Facility"].includes(e)},DataId:function(e){return void 0!==e&&null!==e},DataType:function(e){return["Metric","Set","Group"].includes(e)},StartDate:function(e){return"[object Date]"===Object.prototype.toString.call(e)},EndDate:function(e){return"[object Date]"===Object.prototype.toString.call(e)}};for(var n in t)if(!1===t[n](a.state[n])){console.log(n),console.log(a.state[n]),e=!1;break}return console.log(e),e},a.isSimpleData=function(){return"Facility"===a.state.LocationType&&"Metric"===a.state.DataType},a.formatDate=function(e){return"".concat(e.getUTCFullYear(),"-").concat(("0"+(e.getUTCMonth()+1)).slice(-2),"-").concat(("0"+e.getUTCDate()).slice(-2),"T00:00:00.000Z")},a.getSimpleData=function(){console.log("**************"),console.log(a.state.Data),console.log("**************"),P.Data.where(["FacilityId","MetricId","Time"]).between([a.state.LocationId,a.state.DataId,a.formatDate(a.state.StartDate)],[a.state.LocationId,a.state.DataId,a.formatDate(a.state.EndDate)],!0,!0).toArray(function(e){a.setState({data:{data:e},graphType:"Metric",ready:!0})})},a.getComplexData=function(){if(a.props.RawData){var e="Metric";e=void 0!==a.props.Data.MetricValue&&"-"!==a.props.Data.MetricValue.charAt(0)?"Metric":void 0!==a.props.Data.SetValue?"Set":"Group",a.setState({ready:!0,data:{data:a.props.RawData,name:a.props.Title},graphType:e})}else a.queryComplexData()},a.formatDateForRemoteQuery=function(e){return"".concat(e.getUTCFullYear(),"-").concat(("0"+(e.getUTCMonth()+1)).slice(-2),"-").concat(("0"+e.getUTCDate()).slice(-2))},a.queryComplexData=function(){var e="month";a.state.StartDate.getUTCFullYear()!==a.state.EndDate.getUTCFullYear()&&(e="year");var t="https://essd-backend-dev.azurewebsites.net/api/data/query?LocationId="+a.state.LocationId+"&LocationType="+a.state.LocationType+"&DataId="+a.state.DataId+"&DataType="+a.state.DataType+"&StartDate="+a.formatDateForRemoteQuery(a.state.StartDate)+"&EndDate="+a.formatDateForRemoteQuery(a.state.EndDate)+"&Period="+e+"&Distribution="+a.state.DataPresentation;console.log(t),fetch(t,{}).then(function(t){return t.json().then(function(t){if("year"===e)t.forEach(function(e){e.Value=Number.parseFloat(e.Total)}),t.sort(function(e,t){return e.Metric-t.Metric}),a.setState({ready:!0,data:{data:t,name:a.state.Title},graphType:"Set"});else{for(var n="distribution"===a.state.DataPresentation?"Set":"Metric",r=void 0,o=0;o<t.length;o++){var s=new Date(a.state.StartDate);s.setUTCMonth(t[o].Month-1),t[o].Date=s,t[o].Value=Number.parseInt(t[o].Total),"Set"===n?(t[o].Metric===a.state.Title&&(r=o),t[o].Metric=t[o].Metric.replace("".concat(a.state.Title,", "),"")):t[o].Metric=t[o].Metric}void 0!==r&&t.splice(r,1),a.setState({ready:!0,graphType:n,data:{data:t,name:a.state.Title}})}a.props.ParentHandler&&a.props.ParentHandler(t)})})},a.setStateFromProps=function(e){a.props.Title?a.setState({Title:a.props.Title,LocationName:a.props.Location?a.props.Location.Name:void 0,LocationId:a.props.Location?a.props.Location.Id:void 0,LocationType:a.props.Location?a.props.Location.Type:void 0,DataId:a.props.Data?a.props.Data.Id:void 0,DataType:a.props.Data?a.props.Data.Type:void 0,DataPresentation:a.props.Data?a.props.Data.TotalOrDistribution:void 0,StartDate:a.props.Dates?new Date(a.props.Dates.StartDate):void 0,EndDate:a.props.Dates?new Date(a.props.Dates.EndDate):void 0},function(){e&&e()}):e&&e()},a.run=function(){a.checkInputs()&&(a.isSimpleData()?(console.log("simple data"),a.getSimpleData()):(console.log("complex data"),a.getComplexData()))},a}return Object(y.a)(t,e),Object(f.a)(t,[{key:"componentDidUpdate",value:function(e){e.Location===this.props.Location&&e.Data===this.props.Data&&e.Dates===this.props.Dates||this.setStateFromProps(this.run)}},{key:"componentDidMount",value:function(){this.setStateFromProps(this.run)}},{key:"render",value:function(){return this.checkInputs()?r.a.createElement("div",null,!1===this.state.ready&&r.a.createElement("div",{className:"graphPlaceholder"},r.a.createElement(N.a,null)),!0===this.state.ready&&r.a.createElement("div",null,r.a.createElement(U,{type:this.state.graphType,show:this.props.show,data:this.state.data}))):r.a.createElement("div",{className:"graphPlaceholder"},r.a.createElement(C.a,{description:"We can't display a graph with these inputs."}))}}]),t}(n.Component),Y=(a(88),a(36)),R=a(34),B=a(196),W=(a(100),a(28)),z=["National","State","LGA","Ward","Facility"],J=W.a.Option,_={width:"100%"},Q=function(e){function t(){var e,a;Object(h.a)(this,t);for(var n=arguments.length,o=new Array(n),s=0;s<n;s++)o[s]=arguments[s];return(a=Object(m.a)(this,(e=Object(g.a)(t)).call.apply(e,[this].concat(o)))).findAllLocations=function(e){return new Promise(function(t){var a=function(e){t(e)};switch(e){case"Facility":P.Facility.toArray(a);break;case"Ward":P.Ward.toArray(a);break;case"LGA":P.LGA.toArray(a);break;case"State":P.State.toArray(a)}})},a.state={National:"1|Nigeria|National",State:void 0,LGA:void 0,Ward:void 0,Facility:void 0,StateList:void 0,LGAList:void 0,WardList:void 0,FacilityList:void 0,enabledDisabledLists:{National:!1,State:!1,LGA:!1,Ward:!1,Facility:!1},selectedLocation:"1|Nigeria|National"},a.componentDidUpdate=function(){var e=Object(p.a)(d.a.mark(function e(t){return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.disabled!==a.props.disabled&&a.enableDisableLists();case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),a.componentWillMount=function(){a.setLocations()},a.findIndexForLocationType=function(e){return z.findIndex(function(t){return t===e})},a.setLocations=Object(p.a)(d.a.mark(function e(){var t,n;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t={Type:a.props.maxScope?a.props.maxScope.Type:"National",Id:a.props.maxScope?a.props.maxScope.Id:"1"},console.log(a.props.initialLocation),n={Type:a.props.initialLocation.Type?a.props.initialLocation.Type:t.Type,Id:a.props.initialLocation.Id?a.props.initialLocation.Id:t.Id},a.setState({maxScope:t,initialLocation:n},function(){console.log(a.state);var e=a.findIndexForLocationType(n.Type),t={National:"1|Nigeria|National",State:void 0,LGA:void 0,Ward:void 0,Facility:void 0};a.getLocationHierarchyForInitLocation(e,n.Id,a.setLocationState,t)});case 4:case"end":return e.stop()}},e,this)})),a.getLocationHierarchyForInitLocation=function(){var e=Object(p.a)(d.a.mark(function e(t,n,r,o){var s;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==t){e.next=5;break}return r(o),e.abrupt("return");case 5:return console.log(n),e.next=8,a.findLocationByQuery(z[t],{Id:n});case 8:s=e.sent,console.log(s),s=s[0],o[z[t]]="".concat(s.Id,"|").concat(s.Name,"|").concat(z[t]),a.getLocationHierarchyForInitLocation(t-1,s.parentId,r,o);case 13:case"end":return e.stop()}},e,this)}));return function(t,a,n,r){return e.apply(this,arguments)}}(),a.setLocationState=function(e){a.setState(Object(B.a)({},e),function(){a.notifyParent();for(var e=0;e<z.length;e++)a.updateList(z[e],e,function(){});a.enableDisableLists()})},a.enableDisableLists=function(){var e=a.state.maxScope,t={};if(!0===a.props.disabled)for(var n=0;n<z.length;n++)t[z[n]]=!0;else for(var r=!0,o=0;o<z.length;o++)t[z[o]]=r,z[o]===e.Type&&(r=!1);a.setState({enabledDisabledLists:t})},a.handleChange=function(e,t){var n,r,o=a.findIndexForLocationType(e),s=e;void 0===t||"-1"===a.parseLocation(t).Id?(s=z[o-1],a.setState((n={},Object(R.a)(n,e,void 0),Object(R.a)(n,"selectedLocation",a.state[s]),n),function(){a.notifyParent()})):a.setState((r={},Object(R.a)(r,e,t),Object(R.a)(r,"selectedLocation",t),r),function(){a.notifyParent()});for(var i=function(e){var t=z[e],n=e;a.setState(Object(R.a)({},t,void 0),function(){a.updateList(t,n)})},l=o+1;l<z.length;l++)i(l)},a.updateList=function(){var e=Object(p.a)(d.a.mark(function e(t,n,o){var s,i,l,c,u,p;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(s=[],i="".concat(t,"List"),l=z[n],"State"!==t){e.next=9;break}return e.next=6,a.findAllLocations(t);case 6:s=e.sent,e.next=21;break;case 9:if(n=z.findIndex(function(e){return e===t}),l=z[n],c=z[n-1],void 0!==a.state[c]){e.next=17;break}return a.setState(Object(R.a)({},i,[])),e.abrupt("return");case 17:return u=a.parseLocation(a.state[c]).Id,e.next=20,a.findLocationByQuery(l,{parentId:u});case 20:s=e.sent;case 21:(p=[]).push(r.a.createElement(J,{key:-1,value:"-1||"},r.a.createElement("em",null,"Clear Selection"))),s.forEach(function(e){p.push(r.a.createElement(J,{key:e.Id,value:"".concat(e.Id,"|").concat(e.Name,"|").concat(t)},e.Name))}),p.length>0&&a.setState(Object(R.a)({},i,p)),o&&o();case 26:case"end":return e.stop()}},e,this)}));return function(t,a,n){return e.apply(this,arguments)}}(),a.notifyParent=function(){if(void 0!==a.props.parentHandler&&null!==a.props.parentHandler){for(var e=void 0,t=z.length-1;t>=0;t--)if(void 0!==a.state[z[t]]){e=a.state[z[t]];break}a.props.parentHandler(a.parseLocation(e))}},a}return Object(y.a)(t,e),Object(f.a)(t,[{key:"findLocationByQuery",value:function(e,t){return new Promise(function(a){var n=function(e){a(e)};switch(e){case"Facility":P.Facility.where(t).toArray(n);break;case"Ward":P.Ward.where(t).toArray(n);break;case"LGA":P.LGA.where(t).toArray(n);break;case"State":P.State.where(t).toArray(n)}})}},{key:"parseLocation",value:function(e){if(void 0===e)return{Id:"",Name:"",Type:""};var t=e.split("|");return{Id:t[0],Name:t[1],Type:t[2]}}},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement(W.a,{style:_,placeholder:"Country",optionFilterProp:"children",defaultValue:"Nigeria",disabled:!0},r.a.createElement(J,{value:"Nigeria"},"Nigeria")),r.a.createElement("br",null),r.a.createElement(W.a,{showSearch:!0,style:_,placeholder:"State",optionFilterProp:"children",value:this.state.State,onChange:function(t){e.handleChange("State",t)},disabled:this.state.enabledDisabledLists.State,filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},this.state.StateList),r.a.createElement("br",null),r.a.createElement(W.a,{showSearch:!0,style:_,placeholder:"LGA",optionFilterProp:"children",value:this.state.LGA,onChange:function(t){e.handleChange("LGA",t)},disabled:this.state.enabledDisabledLists.LGA,filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},this.state.LGAList),r.a.createElement("br",null),r.a.createElement(W.a,{showSearch:!0,style:_,placeholder:"Ward",optionFilterProp:"children",value:this.state.Ward,onChange:function(t){e.handleChange("Ward",t)},disabled:this.state.enabledDisabledLists.Ward,filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},this.state.WardList),r.a.createElement("br",null),r.a.createElement(W.a,{showSearch:!0,style:_,placeholder:"Facility",optionFilterProp:"children",value:this.state.Facility,onChange:function(t){e.handleChange("Facility",t)},disabled:this.state.enabledDisabledLists.Facility,filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},this.state.FacilityList),r.a.createElement("br",null),r.a.createElement("div",{hidden:!this.props.showLocation},r.a.createElement("p",null,"Selected Location: ","".concat(this.parseLocation(this.state.selectedLocation).Name," (").concat(this.parseLocation(this.state.selectedLocation).Type,")"))))}}]),t}(n.Component),Z=["Group","Set","Metric"],q=W.a.Option,$={width:"100%"},K=function(e){function t(){var e,a;Object(h.a)(this,t);for(var n=arguments.length,o=new Array(n),s=0;s<n;s++)o[s]=arguments[s];return(a=Object(m.a)(this,(e=Object(g.a)(t)).call.apply(e,[this].concat(o)))).findAll=function(e){return new Promise(function(t){var a=function(e){t(e)};switch(e){case"Metric":P.Metrics.toArray(a);break;case"Set":P.Sets.toArray(a);break;case"Group":P.Groups.toArray(a)}})},a.state={Group:void 0,Set:void 0,Metric:void 0,GroupList:void 0,SetList:void 0,MetricList:void 0,enabledDisabledLists:{Group:!1,Set:!1,Metric:!1},selectedData:void 0},a.componentDidUpdate=function(){var e=Object(p.a)(d.a.mark(function e(t){return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.disabled!==a.props.disabled&&a.enableDisableLists();case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),a.componentDidMount=function(){a.setInitialDataState()},a.findIndexForLocationType=function(e){return Z.findIndex(function(t){return t===e})},a.setInitialDataState=function(){a.enableDisableLists(),void 0===a.props.initialData?(a.updateList("Group",0,null),a.notifyParent()):a.setState({Group:a.props.initialData.GroupValue.length>0?a.props.initialData.GroupValue:void 0,Set:a.props.initialData.SetValue.length>0?a.props.initialData.SetValue:void 0,Metric:a.props.initialData.MetricValue.length>0?a.props.initialData.MetricValue:void 0},function(){a.notifyParent(),a.updateList("Group",0,null),a.updateList("Set",0,null),a.updateList("Metric",0,null)})},a.enableDisableLists=function(){for(var e={},t=void 0!==a.props.disabled&&a.props.disabled,n=0;n<Z.length;n++)e[Z[n]]=t;a.setState({enabledDisabledLists:e})},a.handleChange=function(e,t){var n,r=a.findIndexForLocationType(e);void 0===t||"-1"===a.parseData(t).Id?a.setState(Object(R.a)({},e,void 0),function(){a.createLocationObject(),a.notifyParent()}):a.setState((n={},Object(R.a)(n,e,t),Object(R.a)(n,"selectedData",t),n),function(){a.createLocationObject(),a.notifyParent()});for(var o=function(e){var t=Z[e],n=e;a.setState(Object(R.a)({},t,void 0),function(){a.updateList(t,n),a.createLocationObject()})},s=r+1;s<Z.length;s++)o(s)},a.createLocationObject=function(){var e=void 0,t=void 0,n=void 0;void 0!==a.state.Metric?(e=(n=a.state.Metric.split("|"))[2],t=n[1]):void 0!==a.state.Set?(e=(n=a.state.Set.split("|"))[2],t=n[1]):void 0!==a.state.Group&&(e=(n=a.state.Group.split("|"))[2],t=n[1]);var r=void 0!==e?n[0]:void 0,o="total";if("Metric"!==e){var s=Z[a.findIndexForLocationType(e)+1];if(void 0!==a.state[s]){var i=r.split("-");r=i[2],o="2"===i[1]?"total":"distribution"}}else o="none";return{Type:e,Id:r,Name:t,TotalOrDistribution:o,GroupValue:a.state.Group,SetValue:a.state.Set,MetricValue:a.state.Metric}},a.updateList=function(){var e=Object(p.a)(d.a.mark(function e(t,n,o){var s,i,l,c,u,p,h,f,m;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(s=[],i="".concat(t,"List"),l=Z[n],c=void 0,"Group"!==t){e.next=10;break}return e.next=7,a.findAll(t);case 7:s=e.sent,e.next=22;break;case 10:if(n=Z.findIndex(function(e){return e===t}),l=Z[n],c=Z[n-1],void 0!==a.state[c]){e.next=18;break}return a.setState(Object(R.a)({},i,[])),e.abrupt("return");case 18:return u=a.parseData(a.state[c]).Id,e.next=21,a.findByQuery(l,{parentId:u});case 21:s=e.sent;case 22:if((p=[]).push(r.a.createElement(q,{key:-1,value:"-1||"},r.a.createElement("em",null,"Clear Selection"))),"Set"!==t&&"Metric"!==t||(h="All ".concat(a.state[c].split("|")[1]," (Total)"),p.push(r.a.createElement(q,{key:-1,value:"-2-".concat(a.state[c].split("|")[0],"|").concat(h,"|").concat(c)},h)),f="All ".concat(a.state[c].split("|")[1]," (Distribution)"),p.push(r.a.createElement(q,{key:-1,value:"-3-".concat(a.state[c].split("|")[0],"|").concat(f,"|").concat(c)},f))),"Metric"!==t){e.next=29;break}if("-"!==a.state[c].split("|")[0].charAt(0)){e.next=29;break}return a.setState(Object(R.a)({},i,[])),e.abrupt("return");case 29:m=void 0===c?null:a.state[c].split("|")[1],s.forEach(function(e){m!==e.Name&&p.push(r.a.createElement(q,{key:e.Id,value:"".concat(e.Id,"|").concat(e.Name,"|").concat(t)},e.Name))}),p.length>0&&a.setState(Object(R.a)({},i,p)),o&&o();case 33:case"end":return e.stop()}},e,this)}));return function(t,a,n){return e.apply(this,arguments)}}(),a.notifyParent=function(){void 0!==a.props.parentHandler&&null!==a.props.parentHandler&&a.props.parentHandler(a.createLocationObject())},a}return Object(y.a)(t,e),Object(f.a)(t,[{key:"findByQuery",value:function(e,t){return new Promise(function(a){var n=function(e){a(e)};switch(e){case"Metric":P.Metrics.where(t).toArray(n);break;case"Set":P.Sets.where(t).toArray(n);break;case"Group":P.Groups.where(t).toArray(n)}})}},{key:"parseData",value:function(e){if(void 0===e)return{Id:"",Name:"",Type:""};var t=e.split("|");return{Id:t[0],Name:t[1],Type:t[2]}}},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement(W.a,{showSearch:!0,style:$,placeholder:"Group",optionFilterProp:"children",value:this.state.Group,onChange:function(t){e.handleChange("Group",t)},disabled:this.state.enabledDisabledLists.Group,filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},this.state.GroupList),r.a.createElement("br",null),r.a.createElement(W.a,{showSearch:!0,style:$,placeholder:"Set",optionFilterProp:"children",value:this.state.Set,onChange:function(t){e.handleChange("Set",t)},disabled:this.state.enabledDisabledLists.Set,filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},this.state.SetList),r.a.createElement("br",null),r.a.createElement(W.a,{showSearch:!0,style:$,placeholder:"Metric",optionFilterProp:"children",value:this.state.Metric,onChange:function(t){e.handleChange("Metric",t)},disabled:this.state.enabledDisabledLists.Metric,filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},this.state.MetricList),r.a.createElement("br",null),r.a.createElement("div",{hidden:void 0!==this.props.showLabel&&!this.props.showLabel},r.a.createElement("p",null,"Selected Data: ","".concat(this.createLocationObject().Name," (").concat(this.createLocationObject().Type,")"))))}}]),t}(n.Component);var X={login:function(e,t){return new Promise(function(a,n){var r="".concat("https://essd-backend-dev.azurewebsites.net/api/").concat("users/login");fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({Email:e,Password:t})}).then(function(e){return e.json()}).then(function(e){e.success?P.LocalUser.clear().then(P.LocalUser.add(e.user).then(function(){console.log("Auth Login Success"),a(!0)})).catch(function(e){console.log(e),a(!1)}):a(!1)})})},logout:function(){return new Promise(function(e,t){P.Dashboard.clear().then(function(){}),P.LocalUser.clear().then(function(){e(!0)}).catch(function(t){console.log(t),e(!1)})})},user:function(){return new Promise(function(e,t){P.LocalUser.toArray(function(t){if(1!==t.length)e(null);else{var a=t[0];e(a)}})})}},ee=function(e){function t(){var e,a;Object(h.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(m.a)(this,(e=Object(g.a)(t)).call.apply(e,[this].concat(r)))).saveGraph=function(){P.Dashboard.toCollection().last().then(function(e){var t=0;e&&(t=e.Id+1);var n={Id:t,Title:a.props.Title,Locations:a.props.Locations,Dates:a.props.Dates,Data:a.props.Data,RawData:a.props.RawData};P.Dashboard.put(n).then(function(){O.a.success("Successfully saved to dashboard."),a.props.ParentHandler&&a.props.ParentHandler()})})},a}return Object(y.a)(t,e),Object(f.a)(t,[{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement(L.a,{icon:"save",onClick:this.saveGraph},"Save Graph"))}}]),t}(n.Component),te=(a(449),a(205)),ae=a(17),ne=a.n(ae),re=te.a.MonthPicker,oe=function(e){function t(){var e,a;Object(h.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(m.a)(this,(e=Object(g.a)(t)).call.apply(e,[this].concat(r)))).state={Dates:{StartDate:a.props.initialData.Dates.StartDate,EndDate:a.props.initialData.Dates.EndDate}},a.notifyParent=function(){void 0!==a.props.parentHandler&&null!==a.props.parentHandler&&a.props.parentHandler(a.state.Dates)},a.plusOne=function(e){return e+1},a.dateToString=function(e){return e.getFullYear()+"-"+a.plusOne(e.getMonth())+"-"+a.plusOne(e.getDay())},a}return Object(y.a)(t,e),Object(f.a)(t,[{key:"startDateOnChange",value:function(e,t){var a=this,n=this.state.Dates.EndDate;this.setState({Dates:{StartDate:new Date("".concat(t,"T00:00:00.000Z")),EndDate:n}},function(){a.notifyParent()})}},{key:"endDateOnChage",value:function(e,t){var a=this,n=this.state.Dates.StartDate;this.setState({Dates:{StartDate:n,EndDate:new Date("".concat(t,"T00:00:00.000Z"))}},function(){a.notifyParent()})}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"center"},r.a.createElement(re,{defaultValue:ne()(this.dateToString(this.state.Dates.StartDate),"YYYY-MM-DD"),placeholder:"Start Date",onChange:function(t,a){e.startDateOnChange(t,a)}}),r.a.createElement(re,{defaultValue:ne()(this.dateToString(this.state.Dates.EndDate),"YYYY-MM-DD"),placeholder:"End Date",onChange:function(t,a){e.endDateOnChage(t,a)}}))}}]),t}(n.Component),se=function(e){function t(){var e,a;Object(h.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(m.a)(this,(e=Object(g.a)(t)).call.apply(e,[this].concat(r)))).state={Location:void 0,Data:void 0,Dates:{StartDate:new Date("2015-01-01T00:00:00.000Z"),EndDate:new Date("2019-01-01T00:00:00.000Z")}},a.updateRawData=function(e){a.setState({RawData:e})},a.updateLocation=function(e){a.setState({Location:e})},a.updateData=function(e){a.setState({Data:e})},a.updateDates=function(e){a.setState({Dates:e})},a.createLocationObject=function(){var e=a.state.Location,t={};void 0!==e&&(t["".concat(e.Type,"-").concat(e.Id)]=e);return t},a.getTitle=function(){return void 0!==a.state.Data?a.state.Data.Name.split("(")[0]:"No title"},a}return Object(y.a)(t,e),Object(f.a)(t,[{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement(w.a,{className:"",gutter:16},r.a.createElement(S.a,{xs:{span:24,offset:0},sm:{span:22,offset:1},md:{span:18,offset:3},lg:{span:16,offset:4}},r.a.createElement(I.a,{className:"left",size:"medium",title:"Create a Graph"},r.a.createElement(w.a,{className:"",gutter:16},r.a.createElement("h4",null,"Select Location"),r.a.createElement(Q,{parentHandler:this.updateLocation,initialLocation:{Id:"1215",Type:"Facility"}})),r.a.createElement(Y.a,null),r.a.createElement(w.a,{className:"",gutter:16},r.a.createElement("h4",null,"Select Data"),r.a.createElement(K,{parentHandler:this.updateData,initialData:{GroupValue:"1191|Facility Attendance|Group",SetValue:"-3-1191|All Facility Attendance (Distribution)|Group",MetricValue:""}})),r.a.createElement(Y.a,null),r.a.createElement(w.a,{className:"",gutter:16},r.a.createElement("h4",null,"Select Date Range"),r.a.createElement(oe,{parentHandler:this.updateDates,initialData:{Dates:this.state.Dates}}))))),r.a.createElement(Y.a,null),r.a.createElement(w.a,{className:"",gutter:16},r.a.createElement(S.a,{xs:{span:24,offset:0},sm:{span:22,offset:1},md:{span:18,offset:3},lg:{span:16,offset:4}},r.a.createElement(I.a,{className:"left",size:"medium",title:"Your Graph"},r.a.createElement("div",null,r.a.createElement(H,{Title:void 0!==this.state.Data&&void 0!==this.state.Data.Name?this.state.Data.Name.split("(")[0]:"",Location:this.state.Location,Data:this.state.Data,Dates:this.state.Dates,ParentHandler:this.updateRawData}),r.a.createElement(ee,{Data:this.state.Data,Dates:this.state.Dates,Locations:this.createLocationObject(),Title:this.getTitle(),RawData:this.state.RawData,ParentHandler:this.props.ParentHandler}))))))}}]),t}(n.Component),ie=function(e){function t(){var e,a;Object(h.a)(this,t);for(var n=arguments.length,o=new Array(n),s=0;s<n;s++)o[s]=arguments[s];return(a=Object(m.a)(this,(e=Object(g.a)(t)).call.apply(e,[this].concat(o)))).state={fullSize:!0,reportCard:!1,showGraphs:!0,graphOpenCloseState:null,graphDataLoaded:!1,related:null,relatedGraphs:[]},a.fullSizeOrListChanged=function(e){a.setState({fullSize:"0"!==e.target.value})},a.reportCardOrGraphsChanged=function(e){a.setState({reportCard:"0"!==e.target.value},function(){window.dispatchEvent(new Event("resize"))})},a.toggleGraph=function(e){var t=a.state.graphOpenCloseState,n=!t[e].open;t[e]={open:n};for(var r=!1,o=0;o<Object.keys(t).length-1;o++)if(o!==e&&!0===t[o].open){r=!0;break}t.collapseOrExpandText=r?{text:"Collapse All"}:{text:"Expand All"},a.setState({graphOpenCloseState:t})},a.toggleAllGraphs=function(){for(var e="Collapse All"!==a.state.graphOpenCloseState.collapseOrExpandText.text,t=a.state.graphOpenCloseState,n=0;n<Object.keys(t).length-1;n++)t[n].open=e;t.collapseOrExpandText.text=e?"Collapse All":"Expand All",a.setState({graphOpenCloseState:t})},a.createCollapseExpandButton=function(e){return r.a.createElement(L.a,{key:0,onClick:function(){a.toggleGraph(e)}},a.state.graphOpenCloseState[e].open?"Collapse":"Expand")},a.getFirstLocation=function(e){var t=Object.keys(e);if(t.length>0)return e[t[0]]},a.loadGraphsFromDB=function(){P.Dashboard.toArray().then(function(e){for(var t={},n=0;n<e.length;n++)t[n]={open:!0,showInFilter:!0};console.log(e),t.collapseOrExpandText={text:"Collapse All"},a.setState({graphData:e,graphDataLoaded:!0,graphOpenCloseState:t})})},a.findAllGraphs=function(e){return new Promise(function(t){var a=function(e){t(e)};switch(e.Data.Type){case"Metric":P.Metrics.toArray(a);break;case"Set":case"Group":P.Sets.toArray(a)}})},a.findRelatedGraphs=function(e){return a.findAllGraphs(e).then(function(t){var a=[],n="";return"Group"===e.Data.Type?n=e.Data.Id:t.forEach(function(t){t.Id!==e.Data.Id||(n=t.parentId)}),t.forEach(function(t){t.parentId===n&&t.Id!=e.Data.Id&&a.push(t)}),a})},a.toggleViewRelated=function(){var e=Object(p.a)(d.a.mark(function e(t){var n;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("related"!==a.state.currentView){e.next=4;break}a.setState({currentView:""}),e.next=9;break;case 4:return a.setState({currentView:"related"}),e.next=7,a.findRelatedGraphs(t);case 7:n=e.sent,a.processFoundData(n,t);case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),a.createViewRelatedButton=function(e){return r.a.createElement(L.a,{type:"primary",onClick:function(){a.toggleViewRelated(e)}},"View Related")},a.createDeleteButton=function(e){return r.a.createElement(T.a,{placement:"topRight",title:"Are you sure want to delete this graph?",okText:"Delete",cancelText:"Cancel",onConfirm:function(){a.deleteGraph(e)}},r.a.createElement(L.a,{type:"danger",icon:"delete"},"Delete"))},a.processFoundData=function(e,t){var n=[];console.log(t),console.log(e),e.forEach(function(e){var a=JSON.parse(JSON.stringify(t));a.Title=e.Name,"Set"===t.Data.Type||"Group"===t.Data.Type?a.Title="All "+e.Name:a.Title=e.Name,"Set"===t.Data.Type||"Group"===t.Data.Type?a.Data.Name="All "+e.Name+" (Distribution)":a.Data.Name=e.Name,a.Data.Id=e.Id,a.Dates.StartDate=t.Dates.StartDate,a.Dates.EndDate=t.Dates.EndDate,a.RawData=null,console.log("temp"),console.log(a),n.push(a)}),a.setState({relatedGraphs:n},function(){console.log(a.state.relatedGraphs)})},a.deleteGraph=function(e){P.Dashboard.delete(e.Id).then(function(){P.Dashboard.toArray().then(function(e){a.setState({graphData:e}),O.a.success("Graph successfully deleted.")})})},a.renderRelated=function(){return r.a.createElement(k.a,{itemLayout:"vertical",dataSource:a.state.relatedGraphs,renderItem:function(e,t){return r.a.createElement(k.a.Item,null,r.a.createElement(k.a.Item.Meta,{title:e.Title,description:e.Locations.Name}),r.a.createElement(H,Object.assign({},e,{Location:a.getFirstLocation(e.Locations),show:!0})))}})},a.itemHasCompare=function(e){return Object.keys(e).includes("Compare")},a.renderGraphs=function(){return!0!==a.state.graphDataLoaded?null:r.a.createElement(k.a,{itemLayout:"vertical",dataSource:a.state.graphData,renderItem:function(e,t){return r.a.createElement(k.a.Item,{actions:[a.createCollapseExpandButton(t),a.createViewRelatedButton(e),a.createDeleteButton(e)]},a.itemHasCompare(e)?r.a.createElement("div",null,r.a.createElement(k.a.Item.Meta,{title:e.Title,description:new Date(e.Dates.StartDate).toUTCString().substring(0,new Date(e.Dates.StartDate).toUTCString().length-13)+" - "+new Date(e.Dates.EndDate).toUTCString().substring(0,new Date(e.Dates.EndDate).toUTCString().length-13)}),r.a.createElement(U,{type:e.GraphType,show:!0,data:e.Data})):r.a.createElement("div",null,r.a.createElement(k.a.Item.Meta,{title:e.Title,description:a.getFirstLocation(e.Locations).Name}),r.a.createElement(H,Object.assign({},e,{Location:a.getFirstLocation(e.Locations),show:a.state.graphOpenCloseState[t].open}))))}})},a.showHideCreateGraphUI=function(){a.setState({showGraphs:!a.state.showGraphs},function(){window.dispatchEvent(new Event("resize"))})},a}return Object(y.a)(t,e),Object(f.a)(t,[{key:"componentDidMount",value:function(){this.loadGraphsFromDB()}},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,"related"===this.state.currentView&&r.a.createElement("div",null,r.a.createElement(w.a,{className:"rowVMarginTopSm",gutter:-1},r.a.createElement(S.a,{className:"left",xs:{span:16,offset:0},sm:{span:14,offset:1},md:{span:10,offset:3},lg:{span:8,offset:4}},r.a.createElement("h3",null,"Related Graphs")),r.a.createElement(S.a,{className:"right",span:8},r.a.createElement(L.a,{onClick:function(){e.toggleViewRelated()}},"Back"))),r.a.createElement("div",{className:this.state.showGraphs?"":"displayNone"},r.a.createElement(w.a,{className:"rowVMarginSm",gutter:16},r.a.createElement(S.a,{xs:{span:24,offset:0},sm:{span:22,offset:1},md:{span:18,offset:3},lg:{span:16,offset:4}},r.a.createElement(I.a,{className:"left",size:"small"},this.renderRelated()))))),"related"!==this.state.currentView&&r.a.createElement("div",{className:"center gutterOverflowMask"},this.state.graphDataLoaded&&r.a.createElement("div",{className:this.state.showGraphs?"":"displayNone"},r.a.createElement(w.a,{className:"rowVMarginSm rowVMarginTopSm"},r.a.createElement(S.a,{className:"left",xs:{span:12,offset:0},sm:{span:11,offset:1},md:{span:9,offset:3},lg:{span:8,offset:4}},r.a.createElement(L.a,{onClick:this.toggleAllGraphs},this.state.graphOpenCloseState.collapseOrExpandText.text)),r.a.createElement(S.a,{className:"right",xs:{span:12,offset:0},sm:{span:11,offset:0},md:{span:9,offset:0},lg:{span:8,offset:0}},r.a.createElement(L.a,{icon:"plus",type:"primary",onClick:this.showHideCreateGraphUI},"Add Graph"))),r.a.createElement(w.a,{className:"rowVMarginSm",gutter:16},r.a.createElement(S.a,{xs:{span:24,offset:0},sm:{span:22,offset:1},md:{span:18,offset:3},lg:{span:16,offset:4}},r.a.createElement(I.a,{className:"left",size:"small"},this.renderGraphs())))),r.a.createElement("div",{className:this.state.showGraphs?"displayNone":""},r.a.createElement(w.a,{className:"rowVMarginSm"},r.a.createElement(S.a,null,r.a.createElement(L.a,{icon:"caret-left",onClick:this.showHideCreateGraphUI},"Back"))),r.a.createElement(w.a,{className:"rowVMarginSm"},r.a.createElement(se,{ParentHandler:this.loadGraphsFromDB})))))}}]),t}(n.Component),le=(a(339),a(78),a(91)),ce=a(456),ue=function(e){function t(){var e,a;Object(h.a)(this,t);for(var n=arguments.length,o=new Array(n),s=0;s<n;s++)o[s]=arguments[s];return(a=Object(m.a)(this,(e=Object(g.a)(t)).call.apply(e,[this].concat(o)))).state={Email:null,Password:null},a.handleInput=function(e,t){a.setState(Object(R.a)({},t,e))},a.preTab=function(e){return r.a.createElement("div",{style:{minWidth:"90px",textAlign:"right"}},e)},a.login=function(){X.login(a.state.Email,a.state.Password).then(function(e){e&&a.props.updateDrawer().then(function(e){a.props.history.push("/sync")})})},a}return Object(y.a)(t,e),Object(f.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement(w.a,null,r.a.createElement(S.a,null,r.a.createElement(le.a,{addonBefore:this.preTab("Email"),onChange:function(t){e.handleInput(t.target.value,"Email")},placeholder:"Email"}),r.a.createElement(le.a.Password,{addonBefore:this.preTab("Password"),onChange:function(t){e.handleInput(t.target.value,"Password")},placeholder:"Password"}),r.a.createElement(L.a,{type:"primary",onClick:this.login},"Login")),r.a.createElement(S.a,null)))}}]),t}(n.Component),de=Object(ce.a)(ue),pe=function(e){function t(){var e,a;Object(h.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(m.a)(this,(e=Object(g.a)(t)).call.apply(e,[this].concat(r)))).state={location:null,user:null},a.updateLocation=function(e){console.log(e),a.setState({location:e})},a}return Object(y.a)(t,e),Object(f.a)(t,[{key:"componentWillMount",value:function(){var e=this;X.user().then(function(t){e.setState({user:t})})}},{key:"render",value:function(){return r.a.createElement("div",{className:"sampleApp"},null==this.state.user?r.a.createElement(de,{updateDrawer:this.props.updateDrawer}):r.a.createElement(r.a.Fragment,null,r.a.createElement(K,{parentHandler:this.updateLocation,showLabel:!0,initialData:{Type:"Group",Id:"1191",TotalOrDistribution:"Total",GroupValue:"1191|Facility Attendance|Group",SetValue:"2094|Facility Attendance Male|Set",MetricValue:"-3-2094|All Facility Attendance Male (Distribution)|Set"}}),r.a.createElement(w.a,null," User Name is ",this.state.user.FirstName," "),r.a.createElement(w.a,null,r.a.createElement(S.a,null,r.a.createElement("h4",null,this.state.location?this.state.location.Name:"")))))}}]),t}(n.Component),he=["FirstName","LastName","Phone","Email","Id","LocationId","LocationType","UserType","LocationName"],fe=function(e){function t(){var e,a;Object(h.a)(this,t);for(var n=arguments.length,o=new Array(n),s=0;s<n;s++)o[s]=arguments[s];return(a=Object(m.a)(this,(e=Object(g.a)(t)).call.apply(e,[this].concat(o)))).inputLabelTab=function(e){return r.a.createElement("div",{style:{minWidth:"90px",textAlign:"right"}},e)},a.state={mode:a.props.mode?a.props.mode:"view",userChanged:!1,disabled:!0,locationDisabled:!0,loggedInUser:null},a.isUser=function(){return!0},a.confirmDelete=Object(p.a)(d.a.mark(function e(){var t;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t="https://essd-backend-dev.azurewebsites.net/api/users/deleteUser/".concat(a.state.passedUser.Id),e.next=3,fetch(t,{method:"delete"});case 3:e.sent.json().then(function(e){P.User.delete(a.state.passedUser.Id).then(function(){O.a.success("Successfully deleted user."),a.props.refreshUsers(),a.back()})}).catch(function(e){O.a.error("Sorry, something went wrong.")});case 5:case"end":return e.stop()}},e,this)})),a.adminFeatures=function(){return null!=a.props.user&&null!==a.props.showTable_f?r.a.createElement("div",null,r.a.createElement(S.a,{className:"right"},r.a.createElement(T.a,{placement:"topRight",title:"Are you sure you want to delete this user? This action cannot be reverted.",onConfirm:a.confirmDelete,okText:"Delete",cancelText:"Cancel"},r.a.createElement(L.a,{type:"danger"},"Delete User")))):null},a.inputChanged=function(e,t){var n=a.state.userInfo;n[e]=t.target.value,a.setState({userInfo:n}),a.userInformationChanged()},a.basicFeatures=function(){console.log(a.state.mode);for(var e=["First Name","Last Name","Phone","Email"],t=[],n=function(n){var o=e[n],s=o.replace(" ","");t.push(r.a.createElement(le.a,{addonBefore:a.inputLabelTab(o),value:a.state.userInfo?a.state.userInfo[s]:"",disabled:a.state.disabled||"Email"==o&&"existing"==a.state.mode,key:n,onChange:function(e){a.inputChanged(s,e)}}))},o=0;o<e.length;o++)n(o);var s=[];switch(a.state.userInfo.UserType){case"superadmin":s=[r.a.createElement(W.a.Option,{key:1,value:"superadmin"},"Super Admin"),r.a.createElement(W.a.Option,{key:2,value:"admin"},"Admin"),r.a.createElement(W.a.Option,{key:3,value:"user"},"User")];break;case"admin":s=[r.a.createElement(W.a.Option,{key:2,value:"admin"},"Admin"),r.a.createElement(W.a.Option,{key:3,value:"user"},"User")];break;case"user":s=[r.a.createElement(W.a.Option,{key:3,value:"user"},"User")]}if("new"==a.state.mode)switch(a.state.loggedInUser.UserType){case"superadmin":s=[r.a.createElement(W.a.Option,{key:2,value:"admin"},"Admin"),r.a.createElement(W.a.Option,{key:3,value:"user"},"User")];break;case"admin":s=[r.a.createElement(W.a.Option,{key:3,value:"user"},"User")]}return r.a.createElement("div",null,a.state.ready&&r.a.createElement(S.a,null,r.a.createElement(Y.a,null),t,r.a.createElement(W.a,{style:{width:"100%"},defaultValue:null!=a.state.userInfo.UserType?a.state.userInfo.UserType:"user",placeholder:"User Type",onChange:function(e){a.handleUserTypeSelect(e)},disabled:a.state.loggedInUser.Id==a.state.userInfo.Id||a.state.disabled},s),r.a.createElement(Y.a,null),r.a.createElement("p",null,"Location"),r.a.createElement(Q,{parentHandler:a.updateLocation,showLocation:!0,initialLocation:{Id:a.state.userInfo.LocationId,Type:a.state.userInfo.LocationType},disabled:a.state.loggedInUser.Id==a.state.userInfo.Id||a.state.disabled,maxScope:{Type:a.state.loggedInUser.LocationType,Id:a.state.loggedInUser.LocationId}})))},a.updateLocation=function(e){var t=a.state.userInfo;t.LocationId=e.Id,t.LocationType=e.Type,a.setState({userInfo:t})},a.modifyControls=function(){return a.state.disabled?r.a.createElement("div",null,r.a.createElement(L.a,{onClick:a.enableEditing},"Edit")):r.a.createElement("div",null,r.a.createElement(L.a,{hidden:"new"===a.state.mode,onClick:a.cancelEditing},"Cancel"),r.a.createElement(L.a,{disabled:!a.state.userChanged,onClick:a.save},"Save"))},a.cancelEditing=function(){var e=a.computedState(a.state.passedUser);a.setState({userInfo:e,disabled:!0,locationDisabled:!0}),a.userInformationChanged()},a.enableEditing=function(){X.user().then(function(e){"admin"===e.userType?a.setState({disabled:!1,locationDisabled:!1}):a.setState({disabled:!1,locationDisabled:!0}),a.userInformationChanged()})},a.userInformationChanged=function(){var e=!1;if("new"===a.props.mode)e=!0;else for(var t=0;t<he.length;t++)if(a.state.userInfo[he[t]]!==a.state.passedUser[he[t]]){e=!0;break}a.setState({userChanged:e})},a.save=Object(p.a)(d.a.mark(function e(){var t,n,r,o,s,i;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o="",s=function(){},null==(i=a.state.userInfo).UserType&&(i.UserType="user"),"new"===a.state.mode?(delete i.Id,t="https://essd-backend-dev.azurewebsites.net/api/users/register",n="Successfully added user.",r="Failed to create user. Please try again later.",o="POST",s=function(e){if(!("Id"in e))throw console.log("throwing an error"),new Error(e.error);i.Id=e.Id,i.LocationName=e.LocationName,P.User.add(i).then(function(){O.a.success(n),a.props.refreshUsers(),a.back()})}):(t="https://essd-backend-dev.azurewebsites.net/api/users/updateUser",n="Successfully updated user.",r="Failed to update user. Please try again later.",o="PUT",s=function(e){"Update successful"===e.result&&(a.state.loggedInUser.Id==i.Id?P.LocalUser.put(i).then(function(){O.a.success(n),a.props.refreshUsers(),a.setState({user:i,disabled:!0,locationDisabled:!0})}):P.User.put(i).then(function(){O.a.success(n),a.props.refreshUsers(),a.setState({user:i,disabled:!0,locationDisabled:!0}),a.passedUser=i}))}),e.next=7,fetch(t,{method:o,headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});case 7:e.sent.json().then(s).catch(function(e){console.log(e),O.a.error(r)});case 9:case"end":return e.stop()}},e,this)})),a.back=function(){a.cancelEditing(),a.props.showTable_f()},a}return Object(y.a)(t,e),Object(f.a)(t,[{key:"componentDidMount",value:function(){var e=this;"new"===this.props.mode&&this.enableEditing(),X.user().then(function(t){e.setState({ready:!0,loggedInUser:t})})}},{key:"componentWillMount",value:function(){this.setState({userInfo:this.computedState(this.props.user),passedUser:this.props.user})}},{key:"componentDidUpdate",value:function(e){var t=this.props;e.user!==t.user&&this.setState({passedUser:this.props.user,userInfo:this.computedState(t.user)})}},{key:"computedState",value:function(e){var t={};if(null==e)for(var a=0;a<he.length;a++)t[he[a]]=null;else for(var n=0;n<he.length;n++)he[n]in this.props.user?t[he[n]]=this.props.user[he[n]]:t[he[n]]=null;return t}},{key:"handleUserTypeSelect",value:function(e){var t=this,a=this.state.userInfo;a.UserType=e,this.setState({userInfo:a},function(){console.log(t.state.userInfo)})}},{key:"render",value:function(){return r.a.createElement("div",null,this.state.ready&&r.a.createElement("div",null,this.props.showTable_f&&r.a.createElement(w.a,{className:"rowVMarginSm "},r.a.createElement(S.a,null,r.a.createElement(L.a,{onClick:this.back,icon:"caret-left"},"Back"))),r.a.createElement(w.a,{className:"rowVMarginSm"},r.a.createElement("h3",null,"User Details"),this.modifyControls(),this.basicFeatures(),r.a.createElement(Y.a,null),this.adminFeatures())))}}]),t}(n.Component),me=function(e){function t(){var e,a;Object(h.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(m.a)(this,(e=Object(g.a)(t)).call.apply(e,[this].concat(r)))).state={user:null},a.componentDidMount=function(){X.user().then(function(e){a.setState({user:e})})},a}return Object(y.a)(t,e),Object(f.a)(t,[{key:"render",value:function(){return r.a.createElement("div",null,this.state.user&&r.a.createElement(w.a,{className:"rowVMarginTopSm",gutter:16},r.a.createElement(S.a,{xs:{span:24,offset:0},sm:{span:22,offset:1},md:{span:18,offset:3},lg:{span:16,offset:4}},r.a.createElement(I.a,{className:"rowVMarginTopSm"},r.a.createElement(fe,{showTable_f:null,user:this.state.user,mode:"existing",refreshUsers:function(){}})))))}}]),t}(n.Component),ge=(a(190),a(120)),ye=[],ve=function(e){function t(){var e,a;Object(h.a)(this,t);for(var n=arguments.length,o=new Array(n),s=0;s<n;s++)o[s]=arguments[s];return(a=Object(m.a)(this,(e=Object(g.a)(t)).call.apply(e,[this].concat(o)))).populateUsers=function(){P.User.toArray(function(e){e.forEach(function(e){e.key=e.Id,e.name="".concat(e.FirstName," ").concat(e.LastName),e.permissionLevel=e.LocationType.charAt(0).toUpperCase()+e.LocationType.slice(1)}),ye=e.sort(function(e,t){try{var a=e.LastName.localeCompare(t.LastName);return 0===a?e.FirstName.localeCompare(t.FirstName):a}catch(n){return-1}}),a.setState({dataLoaded:!0}),console.log(ye)})},a.componentWillMount=function(){a.populateUsers()},a.state={showTable:!0,selectedUser:null,dataLoaded:!1,currentView:"table"},a.columns=[{title:"Name",dataIndex:"name",key:"name",defaultSortOrder:"descend",sorter:function(e,t){return e.name.localeCompare(t.name,"en")}},{title:"Scope",dataIndex:"permissionLevel",filters:[{text:"Ward",value:"Ward"},{text:"Facility",value:"Facility"},{text:"LGA",value:"LGA"},{text:"State",value:"State"},{text:"National",value:"National"}],onFilter:function(e,t){return t.permissionLevel===e},filterMultiple:!0,key:"permissionLevel"},{title:"Location",dataIndex:"LocationName",key:"LocationName",defaultSortOrder:"descend",sorter:function(e,t){return e.LocationName.localeCompare(t.LocationName,"en")}},{title:"Action",key:"action",render:function(e,t){return r.a.createElement(L.a,{onClick:function(){a.editUser(t.key)}},"View")}}],a.editUser=function(e){var t=ye.find(function(t){return t.Id===e});a.setState({currentView:"existing",selectedUser:t})},a.showHideTableClass=function(){return"table"===a.state.currentView?"":"displayNone"},a.showHideViewClass=function(){return"existing"===a.state.currentView?"":"displayNone"},a.showTable=function(){a.setState({currentView:"table"})},a.addUser=function(){a.setState({currentView:"new"})},a.tableHidden=function(){return"table"!==a.state.currentView},a.colStyle={xs:{span:24,offset:0},sm:{span:22,offset:1},md:{span:18,offset:3},lg:{span:16,offset:4}},a}return Object(y.a)(t,e),Object(f.a)(t,[{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement(w.a,{className:"rowVMarginSm",hidden:this.state.dataLoaded},r.a.createElement(S.a,this.colStyle,r.a.createElement("div",{className:"spacing"},r.a.createElement(N.a,{size:"large"})))),"table"===this.state.currentView&&r.a.createElement("div",{class:"rowVMarginTopSm"},r.a.createElement(w.a,{className:"rowVMarginTopSm",gutter:16},r.a.createElement(S.a,{className:"left",xs:{span:16,offset:0},sm:{span:14,offset:1},md:{span:10,offset:3},lg:{span:8,offset:4}}),r.a.createElement(S.a,{className:"right",span:8},r.a.createElement(L.a,{onClick:this.addUser,className:this.showHideTableClass(),icon:"user-add",type:"primary"},"Add User")))),r.a.createElement(w.a,{className:"rowVMarginTopSm",gutter:16},r.a.createElement(S.a,this.colStyle,r.a.createElement(I.a,{className:"rowVMarginTopSm"},r.a.createElement("div",{className:"rowVMarginTopSm"},r.a.createElement(ge.a,{dataSource:ye,columns:this.columns,className:this.showHideTableClass()})),"new"!==this.state.currentView?null:r.a.createElement("div",{className:"rowVMarginTopSm"},r.a.createElement(fe,{showTable_f:this.showTable,user:null,mode:"new",refreshUsers:this.populateUsers})),"existing"!==this.state.currentView?null:r.a.createElement("div",{className:"rowVMarginTopSm"},r.a.createElement(fe,{showTable_f:this.showTable,user:this.state.selectedUser,mode:"existing",refreshUsers:this.populateUsers}))))))}}]),t}(n.Component),be=(a(438),a(157)),Ee=function(e){function t(){var e,a;Object(h.a)(this,t);for(var n=arguments.length,o=new Array(n),s=0;s<n;s++)o[s]=arguments[s];return(a=Object(m.a)(this,(e=Object(g.a)(t)).call.apply(e,[this].concat(o)))).state={showProgress:!1,DataDownloads:[]},a.startDownload=function(){for(var e="https://essd-backend-dev.azurewebsites.net/api",t=[{dataName:"user",callback:function(e){return new Promise(function(t){P.User.clear().then(function(){P.User.bulkAdd(e.users).then(function(){t(!0)}).catch(function(e){console.log(e),t(!1)})})})},url:"".concat(e,"/users/getAllUsers/").concat(a.state.user.Id)},{dataName:"location",callback:function(e){return new Promise(function(t){Promise.all([P.State.clear(),P.LGA.clear(),P.Ward.clear(),P.Facility.clear()]).then(Promise.all([P.State.bulkAdd(e.State),P.LGA.bulkAdd(e.LGA),P.Ward.bulkAdd(e.Ward),P.Facility.bulkAdd(e.Facility)]).then(t(!0)).catch(t(!1))).catch(t(!1))})},url:"".concat(e,"/locationsHierarchy")},{dataName:"metric values",callback:function(e){return new Promise(function(t){Promise.all([P.Data.clear()]).then(Promise.all([P.Data.bulkAdd(e.Data)]).then(t(!0)).catch(t(!1))).catch(t(!1))})},url:"".concat(e,"/data/location?state=Zamfara&lga=Anka&ward=Bagega")},{dataName:"metric names",callback:function(e){return new Promise(function(t){Promise.all([P.Groups.clear(),P.Sets.clear(),P.Metrics.clear()]).then(Promise.all([P.Groups.bulkAdd(e.Groups),P.Sets.bulkAdd(e.Sets),P.Metrics.bulkAdd(e.Metrics)]).then(t(!0)).catch(t(!1))).catch(t(!1))})},url:"".concat(e,"/data/hierarchy")}],n=[],o=0;o<t.length;o++){var s=t[o];n.push(r.a.createElement(De,{key:o,dataName:s.dataName,url:s.url,callback:s.callback}))}if(a.state.downloadDashboard){var i="".concat(e,"/dashboard/").concat(a.state.user.Id);n.push(r.a.createElement(De,{key:n.length,dataName:"dashboard information",url:i,callback:function(e){return new Promise(function(t){var a=e.dashboard;P.Dashboard.clear().then(function(){if(a.hasOwnProperty("error"))t(!0);else{var e=JSON.parse(a.DashboardJson);P.Dashboard.bulkAdd(e.dashboards).then(function(){t(!0)})}})})}}))}else{var l="".concat(e,"/dashboard/updateDashboard"),c={method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({UserId:a.state.user.Id,DashboardJson:JSON.stringify(a.state.dashboardData)})};console.log(c.body);n.push(r.a.createElement(De,{key:n.length,dataName:"dashboard information",url:l,callback:function(e){return new Promise(function(t){console.log(e),t(!0)})},params:c}))}a.setState({DataDownloads:n,showProgress:!0})},a}return Object(y.a)(t,e),Object(f.a)(t,[{key:"componentDidMount",value:function(){var e=this;P.Dashboard.toArray().then(function(t){0===t.length?X.user().then(function(t){e.setState({user:t,ready:!0,downloadDashboard:!0})}):X.user().then(function(a){e.setState({user:a,ready:!0,downloadDashboard:!1,dashboardData:{dashboards:t}})})})}},{key:"render",value:function(){return r.a.createElement("div",{className:"center"},r.a.createElement(I.a,{className:"rowVMarginTopSm"},r.a.createElement(w.a,{className:"rowVMarginTopSm"},r.a.createElement(S.a,{xs:24,sm:{span:22,offset:1},md:{span:18,offset:2},lg:{span:16,offset:4},xl:{span:16,offset:4}},r.a.createElement("p",null,r.a.createElement(c.a,{type:"wifi"}),"\xa0 Please note: you must have an internet connection."),this.state.ready&&r.a.createElement(L.a,{type:"primary",onClick:this.startDownload},"Start Sync"))),r.a.createElement(w.a,null,r.a.createElement(S.a,{hidden:!this.state.showProgress,xs:{span:22,offset:1},sm:{span:20,offset:2},md:{span:12,offset:6},lg:{span:10,offset:7},xl:{span:8,offset:8}},r.a.createElement(be.a,{className:"rowVMarginTopSm"},this.state.DataDownloads)))))}}]),t}(n.Component),De=function(e){function t(){var e,a;Object(h.a)(this,t);for(var n=arguments.length,o=new Array(n),s=0;s<n;s++)o[s]=arguments[s];return(a=Object(m.a)(this,(e=Object(g.a)(t)).call.apply(e,[this].concat(o)))).state={pending:!0,failed:!1},a.Icon=function(){return!0===a.state.pending?a.pendingIcon:!0===a.state.failed?a.failedIcon:a.completeIcon},a.pendingIcon=r.a.createElement(c.a,{type:"sync",spin:!0}),a.completeIcon=r.a.createElement(c.a,{type:"check-circle",className:"override-background"}),a.failedIcon=r.a.createElement(c.a,{type:"close-circle"}),a.Message=function(){return!0===a.state.pending?a.pendingMessage:!0===a.state.failed?a.failedMessage:a.completeMessage},a.pendingMessage="Downloading ".concat(a.props.dataName," data"),a.failedMessage="Failed to download ".concat(a.props.dataName," data. Please try again later"),a.completeMessage="Successfully updated ".concat(a.props.dataName," data"),a.get=function(){var e=Object(p.a)(d.a.mark(function e(t,n,r){return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,r);case 2:e.sent.json().then(function(e){n(e).then(function(e){e?a.setState({pending:!1,failed:!1}):a.setState({pending:!1,failed:!0})})});case 4:case"end":return e.stop()}},e,this)}));return function(t,a,n){return e.apply(this,arguments)}}(),a}return Object(y.a)(t,e),Object(f.a)(t,[{key:"componentDidMount",value:function(){this.props.params?this.get(this.props.url,this.props.callback,this.props.params):this.get(this.props.url,this.props.callback)}},{key:"render",value:function(){return r.a.createElement(be.a.Item,{dot:this.Icon()},this.Message())}}]),t}(n.Component),we=Ee,Se=(a(441),function(e){function t(){var e,a;Object(h.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(m.a)(this,(e=Object(g.a)(t)).call.apply(e,[this].concat(r)))).state={location:a.props.initialLocation},a.componnentDidMount=function(){a.setState({location:a.props.initialLocation})},a.notifyParent=function(e){void 0!==a.props.parentHandler&&null!==a.props.parentHandler&&a.props.parentHandler(a.state.location,e)},a.updateLocation=function(e){a.setState({location:e})},a.saveLocation=function(){a.notifyParent(!0)},a.cancelLocation=function(){a.notifyParent(!1)},a}return Object(y.a)(t,e),Object(f.a)(t,[{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement(Q,{parentHandler:this.updateLocation,showLocation:!1,initialLocation:{Id:"1215",Type:"Facility"}}),r.a.createElement(Y.a,null),r.a.createElement(L.a,{onClick:this.saveLocation},"Save"),r.a.createElement(L.a,{onClick:this.cancelLocation},"Cancel"))}}]),t}(n.Component)),Le=function(e){function t(){var e,a;Object(h.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(m.a)(this,(e=Object(g.a)(t)).call.apply(e,[this].concat(r)))).state={metricData:{GroupValue:"1191|Facility Attendance|Group",SetValue:"-3-1191|All Facility Attendance (Distribution)|Group",MetricValue:""},initLoading:!1,loading:!1,locationData:{},showTable:!0,selectedUser:null,dataLoaded:!1,currentView:"table",selectedLocation:null,addingLocation:!1,Dates:{StartDate:new Date("2015-01-01T00:00:00.000Z"),EndDate:new Date("2019-01-01T00:00:00.000Z")},arr:null,dataForSingleLocation:[],dataForAllLocations:[],showGraph:!1,graphType:"Group",data:null},a.generateGraph=function(){var e=[];for(var t in a.state.locationData)e.push(a.state.locationData[t]);"Metric"==a.state.metricData.Type?a.createMetricGraph(e):"Set"==a.state.metricData.Type?a.createSetGraph(e):a.state.metricData.Type,a.setState({currentView:"graph"})},a.formatDate=function(e){return"".concat(e.getUTCFullYear(),"-").concat(("0"+(e.getUTCMonth()+1)).slice(-2),"-").concat(("0"+e.getUTCDate()).slice(-2),"T00:00:00.000Z")},a.createMetricGraph=function(e){var t={dataForAllLocations:[]};a.forEachPromise(e,a.getDataPromiseByLocation,t).then(function(){console.log(a.state.metricData.Name),a.setState({showGraph:!0,currentView:"graph",graphType:"Set",data:{name:a.state.metricData.Name,data:t.dataForAllLocations}})})},a.createSetGraph=function(e){var t=[],n=[];a.getMetricsPromise(a.state.metricData.Id).then(function(r){var o={dataForAllLocations:t,metrics:r,locations:n};a.forEachPromise(e,a.getLocationPromise,o).then(function(){console.log(o.locations),console.log(o.dataForAllLocations),a.setState({showGraph:!0,currentView:"graph",graphType:"Group",data:{data:o.dataForAllLocations,legendTitles:o.locations}}),console.log("donezo")})})},a.forEachPromise=function(e,t,a){return e.reduce(function(e,n){return e.then(function(){return t(n,a)})},Promise.resolve())},a.getLocationPromise=function(e,t){return new Promise(function(n,r){var o={location:e,dataForAllLocations:t.dataForAllLocations,dataForSingleLocation:[]};a.forEachPromise(t.metrics,a.getDataPromise,o).then(function(){t.dataForAllLocations.push(o.dataForSingleLocation),t.locations.push(o.location.Name)}).then(function(){n(!0)})})},a.getMetricsPromise=function(e){return P.Metrics.where("parentId").equalsIgnoreCase(e).toArray()},a.getDataPromise=function(e,t){return new Promise(function(n,r){P.Data.where(["FacilityId","MetricId","Time"]).between([t.location.Id,e.Id,a.formatDate(a.state.Dates.StartDate)],[t.location.Id,e.Id,a.formatDate(a.state.Dates.EndDate)],!0,!0).toArray().then(function(a){var r=0;a.forEach(function(e){r+=parseInt(e.Value)}),t.dataForSingleLocation.push({Value:r,Metric:e.Name}),console.log("Adding Data from current Metric: "+e.Id+", value: "+r),n(!0)})})},a.getDataPromiseByLocation=function(e,t){return new Promise(function(n,r){P.Data.where(["FacilityId","MetricId","Time"]).between([e.Id,a.state.metricData.Id,a.formatDate(a.state.Dates.StartDate)],[e.Id,a.state.metricData.Id,a.formatDate(a.state.Dates.EndDate)],!0,!0).toArray().then(function(a){var r=0;a.forEach(function(e){r+=parseInt(e.Value)}),t.dataForAllLocations.push({Value:r,Metric:e.Name}),console.log("Adding Data from current Location: "+e.Id+", value: "+r),n(!0)})})},a.saveGraph=function(){P.Dashboard.toCollection().last().then(function(e){var t=0;e&&(t=e.Id+1);var n={Id:t,Title:"Compare - "+a.state.metricData.Name,Locations:a.state.locationData,Dates:a.state.Dates,Data:a.state.data,MetricData:a.state.metricData,Compare:!0,GraphType:a.state.graphType};P.Dashboard.put(n).then(function(){console.log(n),O.a.success("Successfully saved to dashboard.")})})},a.updateRawData=function(e){a.setState({RawData:e})},a.updateData=function(e){a.setState({metricData:e})},a.updateLocation=function(e,t){if(t){var n=a.state.locationData;a.state.addingLocation||delete n[a.state.selectedLocation.Type+"-"+a.state.selectedLocation.Id],n[e.Type+"-"+e.Id]=e,a.setState({selectedLocation:e}),O.a.success("Location Saved"),a.setState({locationData:n})}else O.a.warning("Location Not Saved");a.setState({currentView:"table"})},a.addLocation=function(){a.state.selectedLocation=null,a.setState({addingLocation:!0,currentView:"existing"})},a.deleteLocation=function(e){var t=a.state.locationData;delete t[e.Type+"-"+e.Id],a.setState({locationData:t,selectedLocation:null,currentView:"table"}),O.a.success("Location Deleted")},a.editLocation=function(e){a.setState({addingLocation:!1,selectedLocation:e,currentView:"existing"})},a.showTable=function(){a.setState({currentView:"table"})},a.showHideTableClass=function(){return"table"===a.state.currentView?"":"displayNone"},a.updateDates=function(e){a.setState({Dates:e})},a}return Object(y.a)(t,e),Object(f.a)(t,[{key:"render",value:function(){var e=this,t=this.state,a=t.initLoading,n=t.loading;t.list,a||n||r.a.createElement("div",{className:"center"},r.a.createElement(L.a,{onClick:this.addLocation},"Add Location"));return r.a.createElement("div",null,"table"===this.state.currentView&&r.a.createElement("div",{className:"center"},r.a.createElement(w.a,{className:"",gutter:16},r.a.createElement(S.a,{xs:{span:24,offset:0},sm:{span:22,offset:1},md:{span:18,offset:3},lg:{span:16,offset:4}},r.a.createElement(I.a,{className:"left",size:"medium",title:"Select Metric"},r.a.createElement(K,{parentHandler:this.updateData,initialData:this.state.metricData})))),r.a.createElement(Y.a,null),r.a.createElement(w.a,{className:"",gutter:16},r.a.createElement(S.a,{xs:{span:24,offset:0},sm:{span:22,offset:1},md:{span:18,offset:3},lg:{span:16,offset:4}},r.a.createElement(I.a,{className:"left",size:"medium",title:"Select Date"},r.a.createElement(oe,{parentHandler:this.updateDates,initialData:{Dates:this.state.Dates}})))),r.a.createElement(Y.a,null),r.a.createElement(w.a,{className:"",gutter:16},r.a.createElement(S.a,{xs:{span:24,offset:0},sm:{span:22,offset:1},md:{span:18,offset:3},lg:{span:16,offset:4}},r.a.createElement(I.a,{className:"left",size:"medium",title:"Select Location"},r.a.createElement("div",{className:"center"},r.a.createElement(L.a,{type:"primary",block:!0,onClick:this.addLocation},"Add Location")),this.state.locationData&&r.a.createElement(k.a,{itemLayout:"horizontal",size:"large",pagination:{onChange:function(e){console.log(e)},pageSize:4},dataSource:Object.values(this.state.locationData),renderItem:function(t){return r.a.createElement(k.a.Item,{key:t.facility,actions:[r.a.createElement(L.a,{onClick:function(){e.editLocation(t)},style:{marginLeft:8}},"Edit ",r.a.createElement(c.a,{type:"edit"})),r.a.createElement(L.a,{onClick:function(){e.deleteLocation(t)},style:{marginLeft:8}},"Delete ",r.a.createElement(c.a,{type:"delete"}))]},r.a.createElement(k.a.Item.Meta,{title:r.a.createElement("a",{href:"https://ant.design"},t.Name),description:"Location Type: "+t.Type}))}})))),r.a.createElement(Y.a,null),r.a.createElement(w.a,null,r.a.createElement(S.a,{xs:{span:24,offset:0},sm:{span:22,offset:1},md:{span:18,offset:3},lg:{span:16,offset:4}},r.a.createElement("div",{className:"center"},r.a.createElement(L.a,{type:"primary",block:!0,onClick:this.generateGraph},"Generate Graph")))),r.a.createElement(Y.a,null)),"existing"!==this.state.currentView?null:r.a.createElement("div",{className:""},r.a.createElement(w.a,{className:"",gutter:16},r.a.createElement(S.a,{xs:{span:24,offset:0},sm:{span:22,offset:1},md:{span:18,offset:3},lg:{span:16,offset:4}},r.a.createElement(I.a,{className:"left",size:"medium",title:"Select Location"},r.a.createElement(Se,{parentHandler:this.updateLocation,initialLocation:this.state.selectedLocation}))))),"graph"!==this.state.currentView?null:r.a.createElement("div",{className:""},r.a.createElement(I.a,{className:"left",size:"medium",title:"Graph"},r.a.createElement(L.a,{onClick:this.showTable},"Back"),r.a.createElement(Y.a,null),r.a.createElement(L.a,{onClick:this.saveGraph},"Save Graph ",r.a.createElement(c.a,{type:"save"})),r.a.createElement(U,{type:this.state.graphType,show:this.state.showGraph,data:this.state.data}))))}}]),t}(n.Component),Me=(a(443),a(204)),Ie=[{title:"Location",dataIndex:"Name",key:"Location",defaultSortOrder:"ascend",sorter:function(e,t){return e.Name.localeCompare(t.Name,"en")}},{title:"Data Points",dataIndex:"MetricsReportedInLastYear",key:"Reports",sorter:function(e,t){return e.MetricsReportedInLastYear-t.MetricsReportedInLastYear}},{title:"Percent",dataIndex:"Score",key:"Score",sorter:function(e,t){return e.MetricsReportedInLastYear-t.MetricsReportedInLastYear}}],ke=function(e){function t(){var e,a;Object(h.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(m.a)(this,(e=Object(g.a)(t)).call.apply(e,[this].concat(r)))).state={ready:!1},a.setLocation=function(e){a.setState({location:e}),"Ward"===e.Type&&a.getQualityOfData(e.Id)},a.getQualityOfData=function(e){P.Facility.where({parentId:e}).toArray().then(function(e){e.forEach(function(e){e.Score="".concat((e.MetricsReportedInLastYear/6144*100).toFixed(0),"%"),e.key=e.Id}),a.setState({data:e,ready:!0})})},a}return Object(y.a)(t,e),Object(f.a)(t,[{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement(Me.a,{message:"This tool reports the amount of data reported in the last year by each facility in a given ward. Use this to identify the facilities that need the most support in the monthly data collection process.",banner:!0,closable:!0}),r.a.createElement(w.a,{className:"rowVMarginTopSm",gutter:16},r.a.createElement(S.a,{xs:{span:24,offset:0},sm:{span:22,offset:1},md:{span:18,offset:3},lg:{span:16,offset:4}},r.a.createElement(I.a,{className:"rowVMarginTopSm"},r.a.createElement("h3",null,"Select Location"),r.a.createElement(Y.a,null),r.a.createElement(Q,{parentHandler:this.setLocation,initialLocation:{Type:"Ward",Id:"386"}})))),r.a.createElement(w.a,{className:"rowVMarginTopSm",gutter:16},r.a.createElement(S.a,{xs:{span:24,offset:0},sm:{span:22,offset:1},md:{span:18,offset:3},lg:{span:16,offset:4}},this.state.ready&&r.a.createElement(ge.a,{dataSource:this.state.data,columns:Ie}))))}}]),t}(n.Component),Oe=(a(446),v.a.Header),Te=v.a.Footer,Ce=v.a.Content,Ne={"/":"Home","/account":"Account","/dashboard":"Dashboard","/analysis":"Analysis","/users":"Users","/sync":"Synchronize Data","/health":"Data Health"},Ae=function(e){function t(){var e,a;Object(h.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(m.a)(this,(e=Object(g.a)(t)).call.apply(e,[this].concat(r)))).getTitle=function(){var e=window.location.pathname;return e in Ne?Ne[e]:"Hmm...this page has no title"},a.state={drawerOpen:!1,user:null},a.openDrawer=function(){a.setState({drawerOpen:!0})},a.closerDrawer=function(){a.setState({drawerOpen:!1})},a.updateDrawer=function(){return X.user().then(function(e){a.setState({user:e})})},a.logout=Object(p.a)(d.a.mark(function e(){return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a.setState({user:null}),e.next=3,X.logout();case 3:case"end":return e.stop()}},e,this)})),a}return Object(y.a)(t,e),Object(f.a)(t,[{key:"componentWillMount",value:function(){var e=this;X.user().then(function(t){e.setState({user:t}),console.log(e.state.user)})}},{key:"render",value:function(){var e=this;return r.a.createElement(b.a,null,r.a.createElement(v.a,null,null==this.state.user?"":r.a.createElement(i.a,{title:"Menu",placement:"left",closable:!0,onClose:this.closerDrawer,visible:this.state.drawerOpen},r.a.createElement(l.a,{onClick:this.closerDrawer},r.a.createElement(l.a.Item,{key:"2"},r.a.createElement(E.a,{to:"/dashboard"},r.a.createElement(c.a,{type:"area-chart"}),"Dashboard")),r.a.createElement(l.a.Item,{key:"3"},r.a.createElement(E.a,{to:"/analysis"},r.a.createElement(c.a,{type:"stock"}),"Analysis")),r.a.createElement(l.a.Item,{key:"4"},r.a.createElement(E.a,{to:"/health"},r.a.createElement(c.a,{type:"heart"}),"Data Health")),r.a.createElement(l.a.Item,{key:"5"},r.a.createElement(E.a,{to:"/account"},r.a.createElement(c.a,{type:"user"}),"Account")),null!==this.state.user&&"admin"!==this.state.user.UserType?"":r.a.createElement(l.a.Item,{key:"6"},r.a.createElement(E.a,{to:"/users"},r.a.createElement(c.a,{type:"team"}),"Users")),r.a.createElement(l.a.Item,{key:"7"},r.a.createElement(E.a,{to:"/sync"},r.a.createElement(c.a,{type:"sync"}),"Synchronize Data")),null==this.state.user?"":r.a.createElement(l.a.Item,{key:"8",onClick:this.logout},r.a.createElement(E.a,{to:"/"},r.a.createElement(c.a,{type:"poweroff"}),"Logout")))),r.a.createElement(Oe,{style:{padding:0}},r.a.createElement(M,{drawerOpen:this.state.drawerOpen,openDrawer_f:this.openDrawer,title:this.getTitle()})),r.a.createElement(Ce,{className:"min-height-wrapper"},r.a.createElement(D.a,{exact:!0,path:"/",render:function(t){return r.a.createElement(pe,Object.assign({},t,{updateDrawer:e.updateDrawer}))}}),r.a.createElement(D.a,{path:"/dashboard",component:ie}),r.a.createElement(D.a,{path:"/analysis",component:Le}),r.a.createElement(D.a,{path:"/account",component:me}),r.a.createElement(D.a,{path:"/users",component:ve}),r.a.createElement(D.a,{path:"/sync",component:we}),r.a.createElement(D.a,{path:"/health",component:ke})),r.a.createElement(Te,null,r.a.createElement("p",null,"ESSD is an ",r.a.createElement("a",{href:"https://github.com/Epidemic-Surveillance-System-Dashboard/",target:"_blank",rel:"noopener noreferrer"},"open source capstone project")," by Aayush Bahendwar, Jackie Ngo, Laban Lin, and Patrick Lee."),r.a.createElement("p",null,"It is built with components by",r.a.createElement("a",{href:"https://ant.design/",target:"_blank",rel:"noopener noreferrer"}," Ant Financial "),"and powered by",r.a.createElement("a",{href:"https://reactjs.org/",target:"_blank",rel:"noopener noreferrer"}," React "),"."))))}}]),t}(n.Component),je=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function xe(e,t){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var a=e.installing;null!=a&&(a.onstatechange=function(){"installed"===a.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See http://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}}).catch(function(e){console.error("Error during service worker registration:",e)})}s.a.render(r.a.createElement(Ae,null),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",function(){var t="".concat("","/service-worker.js");je?(function(e,t){fetch(e).then(function(a){var n=a.headers.get("content-type");404===a.status||null!=n&&-1===n.indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):xe(e,t)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(t,e),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit http://bit.ly/CRA-PWA")})):xe(t,e)})}}()}},[[209,2,1]]]);
//# sourceMappingURL=main.64731456.chunk.js.map