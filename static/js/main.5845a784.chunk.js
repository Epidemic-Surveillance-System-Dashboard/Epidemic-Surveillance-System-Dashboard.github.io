(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{209:function(e,t,a){e.exports=a(448)},214:function(e,t,a){},234:function(e,t,a){},306:function(e,t,a){},339:function(e,t,a){},441:function(e,t,a){},446:function(e,t,a){},448:function(e,t,a){"use strict";a.r(t);var n=a(1),r=a.n(n),o=a(9),i=a.n(o),s=(a(214),a(216),a(206)),c=(a(450),a(47)),l=(a(92),a(8)),u=a(28),d=a.n(u),p=a(37),h=a(18),f=a(19),m=a(21),g=a(20),y=a(22),v=(a(230),a(91)),b=a(455),E=a(453),D=a(454),w=(a(50),a(15)),S=(a(51),a(10)),L=(a(44),a(16)),M=(a(234),function(e){function t(){var e,a;Object(h.a)(this,t);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return(a=Object(m.a)(this,(e=Object(g.a)(t)).call.apply(e,[this].concat(o)))).rightButtonRenderer=function(){return null!=a.props.rightButtonAction&&null!=a.props.rightButtonType?r.a.createElement(L.a,{type:"default",onClick:a.props.rightButtonAction,className:"ghost-button"},r.a.createElement(l.a,{className:"trigger",type:a.props.rightButtonType?a.props.rightButtonType:"menu-fold"})):null},a}return Object(y.a)(t,e),Object(f.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"navMenu"},r.a.createElement(w.a,null,r.a.createElement(S.a,{span:4},r.a.createElement(L.a,{type:"default",onClick:this.props.openDrawer_f,className:"ghost-button"},r.a.createElement(l.a,{className:"trigger",type:"menu-unfold"}))),r.a.createElement(S.a,{span:16},r.a.createElement("h2",{className:"nowrap center"},this.props.title)),r.a.createElement(S.a,{span:4},this.rightButtonRenderer())))}}]),t}(n.Component)),I=(a(71),a(36)),k=(a(191),a(48)),T=(a(100),a(40)),O=(a(192),a(119)),C=(a(144),a(306),a(86),a(62)),N=(a(98),a(61)),A=a(29),j=["#2980b9","#27ae60","#ef8717","#7f8c8d"],V="#e74c3c",x=0,P=["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"],G=function(e){function t(){var e,a;Object(h.a)(this,t);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return(a=Object(m.a)(this,(e=Object(g.a)(t)).call.apply(e,[this].concat(o)))).getNextColor=function(){var e=j[x];return x=(x+1)%j.length,e},a.resetColor=function(){x=0},a.startDate=null,a.mockMetric={name:"Male Vaccinations Ages 0-19",location:{state:"Ex",lga:"Ex",ward:"Ex",facility:"Ex"},data:[{Month:"JAN",Year:2017,Value:Math.floor(10*Math.random())},{Month:"FEB",Year:2017,Value:Math.floor(10*Math.random())},{Month:"MAR",Year:2017,Value:Math.floor(10*Math.random())},{Month:"APR",Year:2017,Value:Math.floor(10*Math.random())},{Month:"MAY",Year:2017,Value:Math.floor(10*Math.random())},{Month:"JUN",Year:2017,Value:Math.floor(10*Math.random())},{Month:"JUL",Year:2017,Value:Math.floor(10*Math.random())},{Month:"AUG",Year:2017,Value:Math.floor(10*Math.random())},{Month:"SEP",Year:2017,Value:Math.floor(10*Math.random())},{Month:"OCT",Year:2017,Value:Math.floor(10*Math.random())},{Month:"NOV",Year:2017,Value:Math.floor(10*Math.random())},{Month:"DEC",Year:2017,Value:Math.floor(10*Math.random())},{Month:"JAN",Year:2018,Value:Math.floor(10*Math.random())},{Month:"FEB",Year:2018,Value:Math.floor(10*Math.random())},{Month:"MAR",Year:2018,Value:Math.floor(10*Math.random())},{Month:"APR",Year:2018,Value:Math.floor(10*Math.random())},{Month:"MAY",Year:2018,Value:Math.floor(10*Math.random())},{Month:"JUN",Year:2018,Value:Math.floor(10*Math.random())},{Month:"JUL",Year:2018,Value:Math.floor(10*Math.random())},{Month:"AUG",Year:2018,Value:Math.floor(10*Math.random())},{Month:"SEP",Year:2018,Value:Math.floor(10*Math.random())},{Month:"OCT",Year:2018,Value:Math.floor(10*Math.random())},{Month:"NOV",Year:2018,Value:Math.floor(10*Math.random())},{Month:"DEC",Year:2018,Value:Math.floor(10*Math.random())}]},a.mockSet={name:"Male Vaccinations",startDate:"",endDate:"",location:{state:"Ex",lga:"Ex",ward:"Ex",facility:"Ex"},data:[{Value:Math.floor(10*Math.random()),Metric:"Male Vaccinations 0-10"},{Value:Math.floor(10*Math.random()),Metric:"Male Vaccinations 10-40"},{Value:Math.floor(10*Math.random()),Metric:"Male Vaccinations 40-80"},{Value:Math.floor(10*Math.random()),Metric:"Male Vaccinations 80+"}]},a.mockGroup={data:[[{Value:1,Metric:"Metric1"},{Value:2,Metric:"Metric2"},{Value:3,Metric:"Metric3"},{Value:4,Metric:"Metric4"}],[{Value:2,Metric:"Metric1"},{Value:3,Metric:"Metric2"},{Value:4,Metric:"Metric3"},{Value:5,Metric:"Metric4"}],[{Value:3,Metric:"Metric1"},{Value:4,Metric:"Metric2"},{Value:5,Metric:"Metric3"},{Value:6,Metric:"Metric4"}]],legendTitles:["Location 1","Location 2","Location 3"]},a.createBarSeriesData=function(e){var t=a.getNextColor(),n=e.data.filter(function(e){return!("string"===typeof e.Metric&&0===e.Metric.length)}).map(function(e){return{y:e.Metric,x:e.Value}});return{barSeries:r.a.createElement(A.c,{data:n,color:t}),legend:r.a.createElement(A.a,{orientation:"horizontal",items:[{title:e.name,color:t},{title:"Average",color:V}]})}},a.createBarSeriesAverage=function(e){var t=e.data.filter(function(e){return!("string"===typeof e.Metric&&0===e.Metric.length)}),a=0,n=0;t.forEach(function(e){a+=e.Value,n++});var o=n>0?a/n:0,i=t.map(function(e){return{y:e.Metric,x:o}});return r.a.createElement(A.f,{data:i,strokeDasharray:[7,5],color:V})},a.renderGraph=function(){var e=null;switch(a.props.type){case"Group":e=a.MultipleBar();break;case"Set":e=a.Histogram();break;case"Metric":e=a.Line();break;default:e=null}return e},a.defaults={width:350,height:350,xDistance:100,barChartLeftMargin:175},a}return Object(y.a)(t,e),Object(f.a)(t,[{key:"createMultipleBarSeries",value:function(){for(var e=this.props.data.data||this.mockGroup.data,t=0,a=0;a<e.length;a++)for(var n=0;n<e.length;n++)e[a][n].Metric.length>t&&(t=e[a][n].Metric.length);this.defaults.barChartLeftMargin=Math.round(5.5*t+20,0);for(var o={barSeries:[],legend:null,lineData:null},i=0;i<e.length;i++){for(var s=[],c=0;c<e[i].length;c++)s.push({y:e[0][c].Metric,x:e[i][c].Value});o.barSeries.push(r.a.createElement(A.c,{key:i,data:s,color:this.getNextColor()}))}this.resetColor();for(var l=[],u=0;u<this.props.data.legendTitles.length;u++)l.push({title:this.props.data.legendTitles[u],color:this.getNextColor()});return o.legend=r.a.createElement(A.a,{orientation:"horizontal",items:l}),o}},{key:"MultipleBar",value:function(){var e=this.createMultipleBarSeries();return r.a.createElement("div",{className:"center"},r.a.createElement(A.b,{yType:"ordinal",height:this.defaults.height,margin:{left:this.defaults.barChartLeftMargin}},r.a.createElement(A.d,null),r.a.createElement(A.h,null),r.a.createElement(A.i,null),e.barSeries),e.legend)}},{key:"createHistogramData",value:function(){var e=this.props.data;if(0===e.length)return null;var t=e.name.replace("All ","").trim();e.data.forEach(function(e){"string"===typeof e.Metric&&(e.Metric=e.Metric.replace("".concat(t,", "),""),e.Metric=e.Metric.replace("".concat(t),"").trim())});for(var a=0,n=0;n<e.data.length;n++)(""+e.data[n].Metric).length>a&&(a=(""+e.data[n].Metric).length);this.defaults.barChartLeftMargin=Math.round(5.5*a+20,0);var r=this.createBarSeriesData(e);return{barSeries:r.barSeries,legend:r.legend,averageLine:this.createBarSeriesAverage(e)}}},{key:"Histogram",value:function(){var e=this.createHistogramData();return null===e?r.a.createElement("div",null,"empty"):r.a.createElement("div",{className:"center"},r.a.createElement(A.b,{yType:"ordinal",height:this.defaults.height,margin:{left:this.defaults.barChartLeftMargin}},r.a.createElement(A.d,null),r.a.createElement(A.g,null),r.a.createElement(A.h,null),r.a.createElement(A.i,null),e.barSeries,e.averageLine),e.legend)}},{key:"createLineSeriesWithLegend",value:function(){var e={legend:null,series:[]},t=[],a=[],n=0,o=0,i=this.props.data.data||this.mockMetric.data;if(0===i.length)return null;!1===i[0].hasOwnProperty("Date")&&(i.forEach(function(e){e.Date=new Date(e.Time),e.Value=Number.parseInt(e.Value)}),i.sort(function(e,t){return e.Date-t.Date}));for(var s=null,c=[],l=0;l<P.length;l++)c.push({x:P[l],y:0});var u=r.a.createElement(A.e,{key:-1,data:c,color:"transparent",colorType:"literal"});e.series.push(u);for(var d=0;d<i.length;d++)if(null===s&&(s=i[d].Date.getUTCFullYear()),t.push({x:P[i[d].Date.getUTCMonth()],y:i[d].Value}),n+=i[d].Value,o++,d===i.length-1||i[d+1].Date.getUTCFullYear()!==s){var p=this.getNextColor();e.series.push(r.a.createElement(A.e,{key:d,data:t,color:p,colorType:"literal"}));var h="".concat(s);a.push({title:h,color:p}),t=[],d!==i.length-1&&(s=i[d+1].Date.getUTCFullYear())}for(var f=[],m=o>0?n/o:0,g=0;g<P.length;g++)f.push({x:P[g],y:m});a.push({title:"Average",color:V}),e.series.push(r.a.createElement(A.f,{key:e.length+1,data:f,strokeDasharray:[7,5],color:V,colorType:"literal"}));var y=r.a.createElement(A.a,{orientation:"horizontal",items:a});return e.legend=y,e}},{key:"Line",value:function(){var e=this.createLineSeriesWithLegend();return null===e?r.a.createElement("div",{className:"graphPlaceholder"},r.a.createElement(C.a,{description:"Hmm.. we can't find any data"})):r.a.createElement("div",{className:"center"},r.a.createElement(A.b,{xType:"ordinal",height:this.defaults.height},r.a.createElement(A.d,null),r.a.createElement(A.g,null),r.a.createElement(A.h,null),r.a.createElement(A.i,null),e.series),e.legend)}},{key:"render",value:function(){var e=this;if(!1===this.props.show)return null;x=0,Object.keys(this.defaults).forEach(function(t){void 0!==e.props[t]&&(e.defaults[t]=e.props[t])});var t=this.renderGraph();return null!==t?r.a.createElement("div",null,t," ",r.a.createElement("span",null)):r.a.createElement("div",null,"Sorry, something went wrong.")}}]),t}(n.Component),U=new(a(195).a)("ESSD_DB");U.version(1).stores({Facility:"Id,parentId",Ward:"Id,parentId",LGA:"Id,parentId",State:"Id",Groups:"Id",Sets:"Id,parentId",Metrics:"Id,parentId",Data:"Id,Time,MetricId,FacilityId,[FacilityId+MetricId+Time]",User:"Id",LocalUser:"Id",Dashboard:"Id",DashboardData:"Id"});var F=U,Y=function(e){function t(){var e,a;Object(h.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(m.a)(this,(e=Object(g.a)(t)).call.apply(e,[this].concat(r)))).state={ready:!1,data:null},a.checkInputs=function(){var e=!0,t={LocationId:function(e){return void 0!==e&&null!==e},LocationType:function(e){return["National","State","LGA","Ward","Facility"].includes(e)},DataId:function(e){return void 0!==e&&null!==e},DataType:function(e){return["Metric","Set","Group"].includes(e)},StartDate:function(e){return"[object Date]"===Object.prototype.toString.call(e)},EndDate:function(e){return"[object Date]"===Object.prototype.toString.call(e)}};for(var n in t)if(!1===t[n](a.state[n])){e=!1;break}return e},a.isSimpleData=function(){return"Facility"===a.state.LocationType&&"Metric"===a.state.DataType},a.formatDate=function(e){return"".concat(e.getUTCFullYear(),"-").concat(("0"+(e.getUTCMonth()+1)).slice(-2),"-").concat(("0"+e.getUTCDate()).slice(-2),"T00:00:00.000Z")},a.getSimpleData=function(){F.Data.where(["FacilityId","MetricId","Time"]).between([a.state.LocationId,a.state.DataId,a.formatDate(a.state.StartDate)],[a.state.LocationId,a.state.DataId,a.formatDate(a.state.EndDate)],!0,!0).toArray(function(e){a.setState({data:{data:e},graphType:"Metric",ready:!0})})},a.getComplexData=function(){if(a.props.RawData){var e="Metric";e=void 0!==a.props.Data.MetricValue&&"-"!==a.props.Data.MetricValue.charAt(0)?"Metric":void 0!==a.props.Data.SetValue?"Set":"Group",a.setState({ready:!0,data:{data:a.props.RawData,name:a.props.Title},graphType:e})}else a.queryComplexData()},a.formatDateForRemoteQuery=function(e){return"".concat(e.getUTCFullYear(),"-").concat(("0"+(e.getUTCMonth()+1)).slice(-2),"-").concat(("0"+e.getUTCDate()).slice(-2))},a.queryComplexData=function(){var e="month";a.state.StartDate.getUTCFullYear()!==a.state.EndDate.getUTCFullYear()&&(e="year");var t="https://essd-backend-dev.azurewebsites.net/api/data/query?LocationId="+a.state.LocationId+"&LocationType="+a.state.LocationType+"&DataId="+a.state.DataId+"&DataType="+a.state.DataType+"&StartDate="+a.formatDateForRemoteQuery(a.state.StartDate)+"&EndDate="+a.formatDateForRemoteQuery(a.state.EndDate)+"&Period="+e+"&Distribution="+a.state.DataPresentation;console.log(t),fetch(t,{}).then(function(t){return t.json().then(function(t){if("year"===e)t.forEach(function(e){e.Value=Number.parseFloat(e.Total)}),t.sort(function(e,t){return e.Metric-t.Metric}),a.setState({ready:!0,data:{data:t,name:a.state.Title},graphType:"Set"});else{for(var n="distribution"===a.state.DataPresentation?"Set":"Metric",r=void 0,o=0;o<t.length;o++){var i=new Date(a.state.StartDate);i.setUTCMonth(t[o].Month-1),t[o].Date=i,t[o].Value=Number.parseInt(t[o].Total),"Set"===n?(t[o].Metric===a.state.Title&&(r=o),t[o].Metric=t[o].Metric.replace("".concat(a.state.Title,", "),"")):t[o].Metric=t[o].Metric}void 0!==r&&t.splice(r,1),a.setState({ready:!0,graphType:n,data:{data:t,name:a.state.Title}})}a.props.ParentHandler&&a.props.ParentHandler(t)})})},a.setStateFromProps=function(e){a.props.Title?a.setState({Title:a.props.Title,LocationName:a.props.Location?a.props.Location.Name:void 0,LocationId:a.props.Location?a.props.Location.Id:void 0,LocationType:a.props.Location?a.props.Location.Type:void 0,DataId:a.props.Data?a.props.Data.Id:void 0,DataType:a.props.Data?a.props.Data.Type:void 0,DataPresentation:a.props.Data?a.props.Data.TotalOrDistribution:void 0,StartDate:a.props.Dates?new Date(a.props.Dates.StartDate):void 0,EndDate:a.props.Dates?new Date(a.props.Dates.EndDate):void 0},function(){e&&e()}):e&&e()},a.run=function(){a.checkInputs()&&(a.isSimpleData()?a.getSimpleData():a.getComplexData())},a}return Object(y.a)(t,e),Object(f.a)(t,[{key:"componentDidUpdate",value:function(e){e.Location===this.props.Location&&e.Data===this.props.Data&&e.Dates===this.props.Dates||this.setStateFromProps(this.run)}},{key:"componentDidMount",value:function(){this.setStateFromProps(this.run)}},{key:"render",value:function(){return this.checkInputs()?r.a.createElement("div",null,!1===this.state.ready&&r.a.createElement("div",{className:"graphPlaceholder"},r.a.createElement(N.a,null)),!0===this.state.ready&&r.a.createElement("div",null,r.a.createElement(G,{type:this.state.graphType,show:this.props.show,data:this.state.data}))):r.a.createElement("div",{className:"graphPlaceholder"},r.a.createElement(C.a,{description:"We can't display a graph with these inputs."}))}}]),t}(n.Component),W=(a(103),a(39)),H=a(33),B=a(196),R=(a(99),a(25)),z=["National","State","LGA","Ward","Facility"],J=R.a.Option,_={width:"100%"},Q=function(e){function t(){var e,a;Object(h.a)(this,t);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return(a=Object(m.a)(this,(e=Object(g.a)(t)).call.apply(e,[this].concat(o)))).findAllLocations=function(e){return new Promise(function(t){var a=function(e){t(e)};switch(e){case"Facility":F.Facility.toArray(a);break;case"Ward":F.Ward.toArray(a);break;case"LGA":F.LGA.toArray(a);break;case"State":F.State.toArray(a)}})},a.state={National:"1|Nigeria|National",State:void 0,LGA:void 0,Ward:void 0,Facility:void 0,StateList:void 0,LGAList:void 0,WardList:void 0,FacilityList:void 0,enabledDisabledLists:{National:!1,State:!1,LGA:!1,Ward:!1,Facility:!1},selectedLocation:"1|Nigeria|National"},a.componentDidUpdate=function(){var e=Object(p.a)(d.a.mark(function e(t){return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.disabled!==a.props.disabled&&a.enableDisableLists();case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),a.componentWillMount=function(){a.setLocations()},a.findIndexForLocationType=function(e){return z.findIndex(function(t){return t===e})},a.setLocations=Object(p.a)(d.a.mark(function e(){var t,n;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t={Type:a.props.maxScope?a.props.maxScope.Type:"National",Id:a.props.maxScope?a.props.maxScope.Id:"1"},n={Type:a.props.initialLocation.Type?a.props.initialLocation.Type:t.Type,Id:a.props.initialLocation.Id?a.props.initialLocation.Id:t.Id},a.setState({maxScope:t,initialLocation:n},function(){var e=a.findIndexForLocationType(n.Type),t={National:"1|Nigeria|National",State:void 0,LGA:void 0,Ward:void 0,Facility:void 0};a.getLocationHierarchyForInitLocation(e,n.Id,a.setLocationState,t)});case 3:case"end":return e.stop()}},e,this)})),a.getLocationHierarchyForInitLocation=function(){var e=Object(p.a)(d.a.mark(function e(t,n,r,o){var i;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==t){e.next=5;break}return r(o),e.abrupt("return");case 5:return e.next=7,a.findLocationByQuery(z[t],{Id:n});case 7:i=(i=e.sent)[0],o[z[t]]="".concat(i.Id,"|").concat(i.Name,"|").concat(z[t]),a.getLocationHierarchyForInitLocation(t-1,i.parentId,r,o);case 11:case"end":return e.stop()}},e,this)}));return function(t,a,n,r){return e.apply(this,arguments)}}(),a.setLocationState=function(e){a.setState(Object(B.a)({},e),function(){a.notifyParent();for(var e=0;e<z.length;e++)a.updateList(z[e],e,function(){});a.enableDisableLists()})},a.enableDisableLists=function(){var e=a.state.maxScope,t={};if(!0===a.props.disabled)for(var n=0;n<z.length;n++)t[z[n]]=!0;else for(var r=!0,o=0;o<z.length;o++)t[z[o]]=r,z[o]===e.Type&&(r=!1);a.setState({enabledDisabledLists:t})},a.handleChange=function(e,t){var n,r,o=a.findIndexForLocationType(e),i=e;void 0===t||"-1"===a.parseLocation(t).Id?(i=z[o-1],a.setState((n={},Object(H.a)(n,e,void 0),Object(H.a)(n,"selectedLocation",a.state[i]),n),function(){a.notifyParent()})):a.setState((r={},Object(H.a)(r,e,t),Object(H.a)(r,"selectedLocation",t),r),function(){a.notifyParent()});for(var s=function(e){var t=z[e],n=e;a.setState(Object(H.a)({},t,void 0),function(){a.updateList(t,n)})},c=o+1;c<z.length;c++)s(c)},a.updateList=function(){var e=Object(p.a)(d.a.mark(function e(t,n,o){var i,s,c,l,u,p;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=[],s="".concat(t,"List"),c=z[n],"State"!==t){e.next=9;break}return e.next=6,a.findAllLocations(t);case 6:i=e.sent,e.next=21;break;case 9:if(n=z.findIndex(function(e){return e===t}),c=z[n],l=z[n-1],void 0!==a.state[l]){e.next=17;break}return a.setState(Object(H.a)({},s,[])),e.abrupt("return");case 17:return u=a.parseLocation(a.state[l]).Id,e.next=20,a.findLocationByQuery(c,{parentId:u});case 20:i=e.sent;case 21:(p=[]).push(r.a.createElement(J,{key:-1,value:"-1||"},r.a.createElement("em",null,"Clear Selection"))),i.forEach(function(e){p.push(r.a.createElement(J,{key:e.Id,value:"".concat(e.Id,"|").concat(e.Name,"|").concat(t)},e.Name))}),p.length>0&&a.setState(Object(H.a)({},s,p)),o&&o();case 26:case"end":return e.stop()}},e,this)}));return function(t,a,n){return e.apply(this,arguments)}}(),a.notifyParent=function(){if(void 0!==a.props.parentHandler&&null!==a.props.parentHandler){for(var e=void 0,t=z.length-1;t>=0;t--)if(void 0!==a.state[z[t]]){e=a.state[z[t]];break}a.props.parentHandler(a.parseLocation(e))}},a}return Object(y.a)(t,e),Object(f.a)(t,[{key:"findLocationByQuery",value:function(e,t){return new Promise(function(a){var n=function(e){a(e)};switch(e){case"Facility":F.Facility.where(t).toArray(n);break;case"Ward":F.Ward.where(t).toArray(n);break;case"LGA":F.LGA.where(t).toArray(n);break;case"State":F.State.where(t).toArray(n)}})}},{key:"parseLocation",value:function(e){if(void 0===e)return{Id:"",Name:"",Type:""};var t=e.split("|");return{Id:t[0],Name:t[1],Type:t[2]}}},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement(R.a,{style:_,placeholder:"Country",optionFilterProp:"children",defaultValue:"Nigeria",disabled:!0},r.a.createElement(J,{value:"Nigeria"},"Nigeria")),r.a.createElement("br",null),r.a.createElement(R.a,{showSearch:!0,style:_,placeholder:"State",optionFilterProp:"children",value:this.state.State,onChange:function(t){e.handleChange("State",t)},disabled:this.state.enabledDisabledLists.State},this.state.StateList),r.a.createElement("br",null),r.a.createElement(R.a,{style:_,placeholder:"LGA",optionFilterProp:"children",value:this.state.LGA,onChange:function(t){e.handleChange("LGA",t)},disabled:this.state.enabledDisabledLists.LGA},this.state.LGAList),r.a.createElement("br",null),r.a.createElement(R.a,{style:_,placeholder:"Ward",optionFilterProp:"children",value:this.state.Ward,onChange:function(t){e.handleChange("Ward",t)},disabled:this.state.enabledDisabledLists.Ward},this.state.WardList),r.a.createElement("br",null),r.a.createElement(R.a,{style:_,placeholder:"Facility",optionFilterProp:"children",value:this.state.Facility,onChange:function(t){e.handleChange("Facility",t)},disabled:this.state.enabledDisabledLists.Facility},this.state.FacilityList),r.a.createElement("br",null),r.a.createElement("div",{hidden:!this.props.showLocation},r.a.createElement("p",null,"Selected Location: ","".concat(this.parseLocation(this.state.selectedLocation).Name," (").concat(this.parseLocation(this.state.selectedLocation).Type,")"))))}}]),t}(n.Component),Z=["Group","Set","Metric"],q=R.a.Option,$={width:"100%"},K=function(e){function t(){var e,a;Object(h.a)(this,t);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return(a=Object(m.a)(this,(e=Object(g.a)(t)).call.apply(e,[this].concat(o)))).findAll=function(e){return new Promise(function(t){var a=function(e){t(e)};switch(e){case"Metric":F.Metrics.toArray(a);break;case"Set":F.Sets.toArray(a);break;case"Group":F.Groups.toArray(a)}})},a.state={Group:void 0,Set:void 0,Metric:void 0,GroupList:void 0,SetList:void 0,MetricList:void 0,enabledDisabledLists:{Group:!1,Set:!1,Metric:!1},selectedData:void 0},a.componentDidUpdate=function(){var e=Object(p.a)(d.a.mark(function e(t){return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.disabled!==a.props.disabled&&a.enableDisableLists();case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),a.componentDidMount=function(){a.setInitialDataState()},a.findIndexForLocationType=function(e){return Z.findIndex(function(t){return t===e})},a.setInitialDataState=function(){a.enableDisableLists(),void 0===a.props.initialData?(a.updateList("Group",0,null),a.notifyParent()):a.setState({Group:a.getValueForInitialDataProperty("GroupValue"),Set:a.getValueForInitialDataProperty("SetValue"),Metric:a.getValueForInitialDataProperty("MetricValue")},function(){a.notifyParent(),a.updateList("Group",0,null),a.updateList("Set",0,null),a.updateList("Metric",0,null)})},a.getValueForInitialDataProperty=function(e){var t=a.props.initialData[e];if(void 0!==t&&"string"===typeof t){if(0===t.length)return;return t}},a.enableDisableLists=function(){for(var e={},t=void 0!==a.props.disabled&&a.props.disabled,n=0;n<Z.length;n++)e[Z[n]]=t;a.setState({enabledDisabledLists:e})},a.handleChange=function(e,t){var n,r=a.findIndexForLocationType(e);void 0===t||"-1"===a.parseData(t).Id?a.setState(Object(H.a)({},e,void 0),function(){a.createLocationObject(),a.notifyParent()}):a.setState((n={},Object(H.a)(n,e,t),Object(H.a)(n,"selectedData",t),n),function(){a.createLocationObject(),a.notifyParent()});for(var o=function(e){var t=Z[e],n=e;a.setState(Object(H.a)({},t,void 0),function(){a.updateList(t,n),a.createLocationObject()})},i=r+1;i<Z.length;i++)o(i)},a.createLocationObject=function(){var e=void 0,t=void 0,n=void 0;void 0!==a.state.Metric?(e=(n=a.state.Metric.split("|"))[2],t=n[1]):void 0!==a.state.Set?(e=(n=a.state.Set.split("|"))[2],t=n[1]):void 0!==a.state.Group&&(e=(n=a.state.Group.split("|"))[2],t=n[1]);var r=void 0!==e?n[0]:void 0,o="total";if("Metric"!==e){var i=Z[a.findIndexForLocationType(e)+1];if(void 0!==a.state[i]){var s=r.split("-");r=s[2],o="2"===s[1]?"total":"distribution"}}else o="none";return{Type:e,Id:r,Name:t,TotalOrDistribution:o,GroupValue:a.state.Group,SetValue:a.state.Set,MetricValue:a.state.Metric}},a.updateList=function(){var e=Object(p.a)(d.a.mark(function e(t,n,o){var i,s,c,l,u,p,h,f,m;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=[],s="".concat(t,"List"),c=Z[n],l=void 0,"Group"!==t){e.next=10;break}return e.next=7,a.findAll(t);case 7:i=e.sent,e.next=22;break;case 10:if(n=Z.findIndex(function(e){return e===t}),c=Z[n],l=Z[n-1],void 0!==a.state[l]){e.next=18;break}return a.setState(Object(H.a)({},s,[])),e.abrupt("return");case 18:return u=a.parseData(a.state[l]).Id,e.next=21,a.findByQuery(c,{parentId:u});case 21:i=e.sent;case 22:if((p=[]).push(r.a.createElement(q,{key:-1,value:"-1||"},r.a.createElement("em",null,"Clear Selection"))),"Set"!==t&&"Metric"!==t||(h="All ".concat(a.state[l].split("|")[1]," (Total)"),p.push(r.a.createElement(q,{key:-1,value:"-2-".concat(a.state[l].split("|")[0],"|").concat(h,"|").concat(l)},h)),f="All ".concat(a.state[l].split("|")[1]," (Distribution)"),p.push(r.a.createElement(q,{key:-1,value:"-3-".concat(a.state[l].split("|")[0],"|").concat(f,"|").concat(l)},f))),"Metric"!==t){e.next=29;break}if("-"!==a.state[l].split("|")[0].charAt(0)){e.next=29;break}return a.setState(Object(H.a)({},s,[])),e.abrupt("return");case 29:m=void 0===l?null:a.state[l].split("|")[1],i.forEach(function(e){m!==e.Name&&p.push(r.a.createElement(q,{key:e.Id,value:"".concat(e.Id,"|").concat(e.Name,"|").concat(t)},e.Name))}),p.length>0&&a.setState(Object(H.a)({},s,p)),o&&o();case 33:case"end":return e.stop()}},e,this)}));return function(t,a,n){return e.apply(this,arguments)}}(),a.notifyParent=function(){void 0!==a.props.parentHandler&&null!==a.props.parentHandler&&a.props.parentHandler(a.createLocationObject())},a}return Object(y.a)(t,e),Object(f.a)(t,[{key:"findByQuery",value:function(e,t){return new Promise(function(a){var n=function(e){a(e)};switch(e){case"Metric":F.Metrics.where(t).toArray(n);break;case"Set":F.Sets.where(t).toArray(n);break;case"Group":F.Groups.where(t).toArray(n)}})}},{key:"parseData",value:function(e){if(void 0===e)return{Id:"",Name:"",Type:""};var t=e.split("|");return{Id:t[0],Name:t[1],Type:t[2]}}},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement(R.a,{style:$,placeholder:"Group",optionFilterProp:"children",value:this.state.Group,onChange:function(t){e.handleChange("Group",t)},disabled:this.state.enabledDisabledLists.Group},this.state.GroupList),r.a.createElement("br",null),r.a.createElement(R.a,{style:$,placeholder:"Set",optionFilterProp:"children",value:this.state.Set,onChange:function(t){e.handleChange("Set",t)},disabled:this.state.enabledDisabledLists.Set},this.state.SetList),r.a.createElement("br",null),r.a.createElement(R.a,{style:$,placeholder:"Metric",optionFilterProp:"children",value:this.state.Metric,onChange:function(t){e.handleChange("Metric",t)},disabled:this.state.enabledDisabledLists.Metric},this.state.MetricList),r.a.createElement("br",null),r.a.createElement("div",{hidden:void 0!==this.props.showLabel&&!this.props.showLabel},r.a.createElement("p",null,"Selected Data: ","".concat(this.createLocationObject().Name," (").concat(this.createLocationObject().Type,")"))))}}]),t}(n.Component),X=function(e){function t(){var e,a;Object(h.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(m.a)(this,(e=Object(g.a)(t)).call.apply(e,[this].concat(r)))).saveGraph=function(){F.Dashboard.toCollection().last().then(function(e){var t=0;e&&(t=e.Id+1);var n={Id:t,Title:a.props.Title,Locations:a.props.Locations,Dates:a.props.Dates,Data:a.props.Data,RawData:a.props.RawData};F.Dashboard.put(n).then(function(){T.a.success("Successfully saved to dashboard."),a.props.ParentHandler&&a.props.ParentHandler()})})},a}return Object(y.a)(t,e),Object(f.a)(t,[{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement(L.a,{icon:"save",onClick:this.saveGraph},"Save Graph"))}}]),t}(n.Component),ee=(a(449),a(205)),te=a(17),ae=a.n(te),ne=ee.a.MonthPicker,re=function(e){function t(){var e,a;Object(h.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(m.a)(this,(e=Object(g.a)(t)).call.apply(e,[this].concat(r)))).state={Dates:{StartDate:a.props.initialData.Dates.StartDate,EndDate:a.props.initialData.Dates.EndDate}},a.notifyParent=function(){void 0!==a.props.parentHandler&&null!==a.props.parentHandler&&a.props.parentHandler(a.state.Dates)},a.plusOne=function(e){return e+1},a.dateToString=function(e){return e.getFullYear()+"-"+a.plusOne(e.getMonth())+"-"+a.plusOne(e.getDay())},a}return Object(y.a)(t,e),Object(f.a)(t,[{key:"startDateOnChange",value:function(e,t){var a=this,n=this.state.Dates.EndDate;this.setState({Dates:{StartDate:new Date("".concat(t,"T00:00:00.000Z")),EndDate:n}},function(){a.notifyParent()})}},{key:"endDateOnChage",value:function(e,t){var a=this,n=this.state.Dates.StartDate;this.setState({Dates:{StartDate:n,EndDate:new Date("".concat(t,"T00:00:00.000Z"))}},function(){a.notifyParent()})}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"center"},r.a.createElement(ne,{defaultValue:ae()(this.dateToString(this.state.Dates.StartDate),"YYYY-MM-DD"),placeholder:"Start Date",onChange:function(t,a){e.startDateOnChange(t,a)}}),r.a.createElement(ne,{defaultValue:ae()(this.dateToString(this.state.Dates.EndDate),"YYYY-MM-DD"),placeholder:"End Date",onChange:function(t,a){e.endDateOnChage(t,a)}}))}}]),t}(n.Component),oe=function(e){function t(){var e,a;Object(h.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(m.a)(this,(e=Object(g.a)(t)).call.apply(e,[this].concat(r)))).state={Location:void 0,Data:void 0,Dates:{StartDate:new Date("2015-01-01T00:00:00.000Z"),EndDate:new Date("2019-01-01T00:00:00.000Z")}},a.updateRawData=function(e){a.setState({RawData:e})},a.updateLocation=function(e){a.setState({Location:e})},a.updateData=function(e){a.setState({Data:e})},a.updateDates=function(e){a.setState({Dates:e})},a.createLocationObject=function(){var e=a.state.Location,t={};void 0!==e&&(t["".concat(e.Type,"-").concat(e.Id)]=e);return t},a.getTitle=function(){return void 0!==a.state.Data?a.state.Data.Name.split("(")[0]:"No title"},a}return Object(y.a)(t,e),Object(f.a)(t,[{key:"render",value:function(){return r.a.createElement(I.a,{className:"left",size:"medium",title:"Create a Graph"},r.a.createElement(w.a,{className:"",gutter:16},r.a.createElement(S.a,null,r.a.createElement("h4",null,"Select Location"),r.a.createElement(Q,{parentHandler:this.updateLocation,initialLocation:{Id:"1215",Type:"Facility"}}))),r.a.createElement(W.a,null),r.a.createElement(w.a,{className:"",gutter:16},r.a.createElement(S.a,null,r.a.createElement("h4",null,"Select Data"),r.a.createElement(K,{parentHandler:this.updateData,initialData:{GroupValue:"1191|Facility Attendance|Group",SetValue:"-3-1191|All Facility Attendance (Distribution)|Group",MetricValue:""}}))),r.a.createElement(W.a,null),r.a.createElement(w.a,{className:"",gutter:16},r.a.createElement(S.a,null,r.a.createElement("h4",null,"Select Date Range"),r.a.createElement(re,{parentHandler:this.updateDates,initialData:{Dates:this.state.Dates}}))),r.a.createElement(W.a,null),r.a.createElement(w.a,null,r.a.createElement(S.a,null,r.a.createElement("h4",null,"Generated Graph"),r.a.createElement(Y,{Title:void 0!==this.state.Data&&void 0!==this.state.Data.Name?this.state.Data.Name.split("(")[0]:"",Location:this.state.Location,Data:this.state.Data,Dates:this.state.Dates,ParentHandler:this.updateRawData}),r.a.createElement(X,{Data:this.state.Data,Dates:this.state.Dates,Locations:this.createLocationObject(),Title:this.getTitle(),RawData:this.state.RawData,ParentHandler:this.props.ParentHandler}))))}}]),t}(n.Component),ie=function(e){function t(){var e,a;Object(h.a)(this,t);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return(a=Object(m.a)(this,(e=Object(g.a)(t)).call.apply(e,[this].concat(o)))).state={fullSize:!0,graphOpenCloseState:null,graphDataLoaded:!1,related:null,relatedGraphs:[],prevScollPos:0,currentView:"dashboard"},a.fullSizeOrListChanged=function(e){a.setState({fullSize:"0"!==e.target.value})},a.toggleGraph=function(e){var t=a.state.graphOpenCloseState,n=!t[e].open;t[e]={open:n};for(var r=!1,o=0;o<Object.keys(t).length-1;o++)if(o!==e&&!0===t[o].open){r=!0;break}t.collapseOrExpandText=r?{text:"Collapse All"}:{text:"Expand All"},a.setState({graphOpenCloseState:t})},a.toggleAllGraphs=function(){for(var e="Collapse All"!==a.state.graphOpenCloseState.collapseOrExpandText.text,t=a.state.graphOpenCloseState,n=0;n<Object.keys(t).length-1;n++)t[n].open=e;t.collapseOrExpandText.text=e?"Collapse All":"Expand All",a.setState({graphOpenCloseState:t})},a.createCollapseExpandButton=function(e){return r.a.createElement(L.a,{key:0,className:"condensed",onClick:function(){a.toggleGraph(e)}},a.state.graphOpenCloseState[e].open?"Collapse":"Expand")},a.getFirstLocation=function(e){var t=Object.keys(e);if(t.length>0)return e[t[0]]},a.loadGraphsFromDB=function(){F.Dashboard.toArray().then(function(e){for(var t={},n=0;n<e.length;n++)t[n]={open:!0,showInFilter:!0};t.collapseOrExpandText={text:"Collapse All"},a.setState({graphData:e,graphDataLoaded:!0,graphOpenCloseState:t})})},a.findAllGraphs=function(e){return new Promise(function(t){var a=function(e){t(e)};switch(e.Data.Type){case"Metric":F.Metrics.toArray(a);break;case"Set":case"Group":F.Sets.toArray(a)}})},a.findRelatedGraphs=function(e){return a.findAllGraphs(e).then(function(t){var a=[],n="";return"Group"===e.Data.Type?n=e.Data.Id:t.forEach(function(t){t.Id!==e.Data.Id||(n=t.parentId)}),t.forEach(function(t){t.parentId===n&&t.Id!==e.Data.Id&&a.push(t)}),a})},a.toggleViewRelated=function(){var e=Object(p.a)(d.a.mark(function e(t){var n;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("related"!==a.state.currentView){e.next=4;break}a.setState({currentView:"dashboard"},function(){window.scrollTo(0,a.state.prevScollPos),window.dispatchEvent(new Event("resize"))}),e.next=9;break;case 4:return a.setState({currentView:"related",prevScollPos:window.pageYOffset},function(){window.scrollTo(0,0)}),e.next=7,a.findRelatedGraphs(t);case 7:n=e.sent,a.processFoundData(n,t);case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),a.createViewRelatedButton=function(e){return r.a.createElement(L.a,{type:"primary",className:"condensed",onClick:function(){a.toggleViewRelated(e)}},"View Related")},a.createDeleteButton=function(e){return r.a.createElement(O.a,{placement:"top",title:"Are you sure want to delete this graph?",okText:"Delete",cancelText:"Cancel",onConfirm:function(){a.deleteGraph(e)}},r.a.createElement(L.a,{className:"condensed",type:"danger",icon:"delete"},"Delete"))},a.processFoundData=function(e,t){var n=[];e.forEach(function(e){var a=JSON.parse(JSON.stringify(t));a.Title=e.Name,"Set"===t.Data.Type||"Group"===t.Data.Type?a.Title="All "+e.Name:a.Title=e.Name,"Set"===t.Data.Type||"Group"===t.Data.Type?a.Data.Name="All "+e.Name+" (Distribution)":a.Data.Name=e.Name,a.Data.Id=e.Id,a.Dates.StartDate=t.Dates.StartDate,a.Dates.EndDate=t.Dates.EndDate,a.RawData=null,n.push(a)}),a.setState({relatedGraphs:n})},a.deleteGraph=function(e){F.Dashboard.delete(e.Id).then(function(){F.Dashboard.toArray().then(function(e){a.setState({graphData:e}),T.a.success("Graph successfully deleted.")})})},a.renderRelated=function(){return r.a.createElement(k.a,{itemLayout:"vertical",dataSource:a.state.relatedGraphs,renderItem:function(e,t){return r.a.createElement(k.a.Item,null,r.a.createElement(k.a.Item.Meta,{title:e.Title,description:e.Locations.Name}),r.a.createElement(Y,Object.assign({},e,{Location:a.getFirstLocation(e.Locations),show:!0})))}})},a.itemHasCompare=function(e){return Object.keys(e).includes("Compare")},a.showWhenCurrentViewIs=function(e,t){return a.state.currentView===e?t:"".concat(t," displayNone")},a.showWhenCurrentViewIsNot=function(e,t){return a.state.currentView!==e?t:"".concat(t," displayNone")},a.renderGraphs=function(){return!0!==a.state.graphDataLoaded?null:r.a.createElement(k.a,{itemLayout:"vertical",dataSource:a.state.graphData,renderItem:function(e,t){return r.a.createElement(k.a.Item,{actions:[a.createCollapseExpandButton(t),a.createViewRelatedButton(e),a.createDeleteButton(e)]},a.itemHasCompare(e)?r.a.createElement("div",null,r.a.createElement(k.a.Item.Meta,{title:e.Title,description:new Date(e.Dates.StartDate).toUTCString().substring(0,new Date(e.Dates.StartDate).toUTCString().length-13)+" - "+new Date(e.Dates.EndDate).toUTCString().substring(0,new Date(e.Dates.EndDate).toUTCString().length-13)}),r.a.createElement(G,{type:e.GraphType,show:!0,data:e.Data})):r.a.createElement("div",null,r.a.createElement(k.a.Item.Meta,{title:e.Title,description:a.getFirstLocation(e.Locations).Name}),r.a.createElement(Y,Object.assign({},e,{Location:a.getFirstLocation(e.Locations),show:a.state.graphOpenCloseState[t].open}))))}})},a.setView=function(e){a.setState({currentView:e},function(){window.dispatchEvent(new Event("resize"))})},a}return Object(y.a)(t,e),Object(f.a)(t,[{key:"componentDidMount",value:function(){this.loadGraphsFromDB()}},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement("div",{className:this.showWhenCurrentViewIs("related","center")},r.a.createElement(w.a,{className:"rowVMarginSm rowVMarginTopSm left"},r.a.createElement(L.a,{icon:"caret-left",onClick:function(){e.toggleViewRelated()}},"Back")),r.a.createElement(w.a,{className:"rowVMarginSm rowVMarginTopSm",gutter:16},r.a.createElement(S.a,{xs:{span:24,offset:0},sm:{span:22,offset:1},md:{span:18,offset:3},lg:{span:16,offset:4}},r.a.createElement(I.a,{className:"left",size:"medium",title:"Related Graphs"},this.renderRelated())))),r.a.createElement("div",{className:this.showWhenCurrentViewIsNot("related","center")},this.state.graphDataLoaded&&r.a.createElement("div",{className:this.showWhenCurrentViewIs("dashboard","")},r.a.createElement(w.a,{className:"rowVMarginSm rowVMarginTopSm"},r.a.createElement(S.a,{className:"left",xs:{span:12,offset:0},sm:{span:11,offset:1},md:{span:9,offset:3},lg:{span:8,offset:4}},r.a.createElement(L.a,{onClick:this.toggleAllGraphs},this.state.graphOpenCloseState.collapseOrExpandText.text)),r.a.createElement(S.a,{className:"right",xs:{span:12,offset:0},sm:{span:11,offset:0},md:{span:9,offset:0},lg:{span:8,offset:0}},r.a.createElement(L.a,{icon:"plus",type:"primary",onClick:function(){e.setView("createGraph")}},"Add Graph"))),r.a.createElement(w.a,{className:"rowVMarginSm",gutter:16},r.a.createElement(S.a,{xs:{span:24,offset:0},sm:{span:22,offset:1},md:{span:18,offset:3},lg:{span:16,offset:4}},r.a.createElement(I.a,{className:"left",size:"small"},this.renderGraphs())))),r.a.createElement("div",{className:this.showWhenCurrentViewIs("createGraph","")},r.a.createElement(w.a,{className:"rowVMarginSm rowVMarginTopSm"},r.a.createElement(S.a,{className:"left"},r.a.createElement(L.a,{icon:"caret-left",onClick:function(){e.setView("dashboard")}},"Back"))),r.a.createElement(w.a,{className:"rowVMarginSm"},r.a.createElement(oe,{ParentHandler:this.loadGraphsFromDB})))))}}]),t}(n.Component),se=(a(339),a(78),a(90));var ce={login:function(e,t){return new Promise(function(a,n){var r="".concat("https://essd-backend-dev.azurewebsites.net/api/").concat("users/login");fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({Email:e,Password:t})}).then(function(e){return e.json()}).then(function(e){e.success?F.LocalUser.clear().then(F.LocalUser.add(e.user).then(function(){console.log("Auth Login Success"),a(!0)})).catch(function(e){console.log(e),a(!1)}):a(!1)})})},logout:function(){return new Promise(function(e,t){F.Dashboard.clear().then(function(){}),F.LocalUser.clear().then(function(){e(!0)}).catch(function(t){console.log(t),e(!1)})})},user:function(){return new Promise(function(e,t){F.LocalUser.toArray(function(t){if(1!==t.length)e(null);else{var a=t[0];e(a)}})})}},le=a(456),ue=function(e){function t(){var e,a;Object(h.a)(this,t);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return(a=Object(m.a)(this,(e=Object(g.a)(t)).call.apply(e,[this].concat(o)))).state={Email:null,Password:null},a.handleInput=function(e,t){a.setState(Object(H.a)({},t,e))},a.preTab=function(e){return r.a.createElement("div",{style:{minWidth:"90px",textAlign:"right"}},e)},a.login=function(){ce.login(a.state.Email,a.state.Password).then(function(e){e&&a.props.updateDrawer().then(function(e){a.props.history.push("/sync")})})},a.colStyle={xs:{span:24,offset:0},sm:{span:22,offset:1},md:{span:16,offset:4},lg:{span:10,offset:7}},a}return Object(y.a)(t,e),Object(f.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement(I.a,null,r.a.createElement(w.a,null,r.a.createElement(S.a,this.colStyle,r.a.createElement(se.a,{addonBefore:this.preTab("Email"),type:"email",onChange:function(t){e.handleInput(t.target.value,"Email")},placeholder:"Email"}),r.a.createElement(se.a.Password,{addonBefore:this.preTab("Password"),onChange:function(t){e.handleInput(t.target.value,"Password")},placeholder:"Password"}))),r.a.createElement("br",null),r.a.createElement(w.a,null,r.a.createElement(S.a,Object.assign({},this.colStyle,{className:"center"}),r.a.createElement(L.a,{type:"primary",onClick:this.login},"Login"))))}}]),t}(n.Component),de=Object(le.a)(ue),pe=function(e){function t(){return Object(h.a)(this,t),Object(m.a)(this,Object(g.a)(t).apply(this,arguments))}return Object(y.a)(t,e),Object(f.a)(t,[{key:"componentWillMount",value:function(){var e=this;ce.user().then(function(t){null!==t&&e.props.history.replace("/dashboard")})}},{key:"render",value:function(){return r.a.createElement(de,{updateDrawer:this.props.updateDrawer})}}]),t}(n.Component),he=["FirstName","LastName","Phone","Email","Id","LocationId","LocationType","UserType","LocationName"],fe=function(e){function t(){var e,a;Object(h.a)(this,t);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return(a=Object(m.a)(this,(e=Object(g.a)(t)).call.apply(e,[this].concat(o)))).inputLabelTab=function(e){return r.a.createElement("div",{style:{minWidth:"90px",textAlign:"right"}},e)},a.state={mode:a.props.mode?a.props.mode:"view",userChanged:!1,disabled:!0,locationDisabled:!0,loggedInUser:null},a.isUser=function(){return!0},a.confirmDelete=Object(p.a)(d.a.mark(function e(){var t;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t="https://essd-backend-dev.azurewebsites.net/api/users/deleteUser/".concat(a.state.passedUser.Id),e.next=3,fetch(t,{method:"delete"});case 3:e.sent.json().then(function(e){F.User.delete(a.state.passedUser.Id).then(function(){T.a.success("Successfully deleted user."),a.props.refreshUsers(),a.back()})}).catch(function(e){T.a.error("Sorry, something went wrong.")});case 5:case"end":return e.stop()}},e,this)})),a.adminFeatures=function(){return null!=a.props.user&&null!==a.props.showTable_f?r.a.createElement("div",null,r.a.createElement(W.a,null),r.a.createElement(S.a,{className:"right"},r.a.createElement(O.a,{placement:"topRight",title:"Are you sure you want to delete this user? This action cannot be reverted.",onConfirm:a.confirmDelete,okText:"Delete",cancelText:"Cancel"},r.a.createElement(L.a,{type:"danger"},"Delete User")))):null},a.inputChanged=function(e,t){var n=a.state.userInfo;n[e]=t.target.value,a.setState({userInfo:n}),a.userInformationChanged()},a.basicFeatures=function(){for(var e=["First Name","Last Name","Phone","Email"],t=[],n=function(n){var o=e[n],i=o.replace(" ","");t.push(r.a.createElement(se.a,{addonBefore:a.inputLabelTab(o),value:a.state.userInfo?a.state.userInfo[i]:"",disabled:a.state.disabled||"Email"===o&&"existing"===a.state.mode,key:n,onChange:function(e){a.inputChanged(i,e)}}))},o=0;o<e.length;o++)n(o);var i=[];switch(a.state.userInfo.UserType){case"superadmin":i=[r.a.createElement(R.a.Option,{key:1,value:"superadmin"},"Super Admin"),r.a.createElement(R.a.Option,{key:2,value:"admin"},"Admin"),r.a.createElement(R.a.Option,{key:3,value:"user"},"User")];break;case"admin":i=[r.a.createElement(R.a.Option,{key:2,value:"admin"},"Admin"),r.a.createElement(R.a.Option,{key:3,value:"user"},"User")];break;case"user":default:i=[r.a.createElement(R.a.Option,{key:3,value:"user"},"User")]}if("new"===a.state.mode)switch(a.state.loggedInUser.UserType){case"superadmin":i=[r.a.createElement(R.a.Option,{key:2,value:"admin"},"Admin"),r.a.createElement(R.a.Option,{key:3,value:"user"},"User")];break;case"admin":default:i=[r.a.createElement(R.a.Option,{key:3,value:"user"},"User")]}return r.a.createElement("div",null,a.state.ready&&r.a.createElement(S.a,null,r.a.createElement(W.a,null),r.a.createElement("p",null,"Basic Information"),t,r.a.createElement(R.a,{style:{width:"100%"},defaultValue:null!=a.state.userInfo.UserType?a.state.userInfo.UserType:"user",placeholder:"User Type",onChange:function(e){a.handleUserTypeSelect(e)},disabled:a.state.loggedInUser.Id===a.state.userInfo.Id||a.state.disabled},i),r.a.createElement(W.a,null),r.a.createElement("p",null,"Location"),r.a.createElement(Q,{parentHandler:a.updateLocation,showLocation:!0,initialLocation:{Id:a.state.userInfo.LocationId,Type:a.state.userInfo.LocationType},disabled:a.state.loggedInUser.Id===a.state.userInfo.Id||a.state.disabled,maxScope:{Type:a.state.loggedInUser.LocationType,Id:a.state.loggedInUser.LocationId}})))},a.updateLocation=function(e){var t=a.state.userInfo;t.LocationId=e.Id,t.LocationType=e.Type,a.setState({userInfo:t})},a.modifyControls=function(){return a.state.disabled?r.a.createElement("div",null,r.a.createElement(L.a,{onClick:a.enableEditing},"Edit")):r.a.createElement(w.a,null,r.a.createElement(S.a,{span:12},r.a.createElement(L.a,{hidden:"new"===a.state.mode,onClick:a.cancelEditing},"Cancel")),r.a.createElement(S.a,{className:"right",span:12},r.a.createElement(L.a,{type:"primary",disabled:!a.state.userChanged,onClick:a.save},"Save")))},a.cancelEditing=function(){var e=a.computedState(a.state.passedUser);a.setState({userInfo:e,disabled:!0,locationDisabled:!0}),a.userInformationChanged()},a.enableEditing=function(){ce.user().then(function(e){"admin"===e.userType?a.setState({disabled:!1,locationDisabled:!1}):a.setState({disabled:!1,locationDisabled:!0}),a.userInformationChanged()})},a.userInformationChanged=function(){var e=!1;if("new"===a.props.mode)e=!0;else for(var t=0;t<he.length;t++)if(a.state.userInfo[he[t]]!==a.state.passedUser[he[t]]){e=!0;break}a.setState({userChanged:e})},a.save=Object(p.a)(d.a.mark(function e(){var t,n,r,o,i,s;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o="",i=function(){},null==(s=a.state.userInfo).UserType&&(s.UserType="user"),"new"===a.state.mode?(delete s.Id,t="https://essd-backend-dev.azurewebsites.net/api/users/register",n="Successfully added user.",r="Failed to create user. Please try again later.",o="POST",i=function(e){if(!("Id"in e))throw console.log("throwing an error"),new Error(e.error);s.Id=e.Id,s.LocationName=e.LocationName,F.User.add(s).then(function(){T.a.success(n),a.props.refreshUsers(),a.back()})}):(t="https://essd-backend-dev.azurewebsites.net/api/users/updateUser",n="Successfully updated user.",r="Failed to update user. Please try again later.",o="PUT",i=function(e){"Update successful"===e.result&&(a.state.loggedInUser.Id===s.Id?F.LocalUser.put(s).then(function(){T.a.success(n),a.props.refreshUsers(),a.setState({user:s,disabled:!0,locationDisabled:!0})}):F.User.put(s).then(function(){T.a.success(n),a.props.refreshUsers(),a.setState({user:s,disabled:!0,locationDisabled:!0}),a.passedUser=s}))}),e.next=7,fetch(t,{method:o,headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});case 7:e.sent.json().then(i).catch(function(e){console.log(e),T.a.error(r)});case 9:case"end":return e.stop()}},e,this)})),a.back=function(){a.cancelEditing(),a.props.showTable_f()},a}return Object(y.a)(t,e),Object(f.a)(t,[{key:"componentDidMount",value:function(){var e=this;"new"===this.props.mode&&this.enableEditing(),ce.user().then(function(t){e.setState({ready:!0,loggedInUser:t})})}},{key:"componentWillMount",value:function(){this.setState({userInfo:this.computedState(this.props.user),passedUser:this.props.user})}},{key:"componentDidUpdate",value:function(e){var t=this.props;e.user!==t.user&&this.setState({passedUser:this.props.user,userInfo:this.computedState(t.user)})}},{key:"computedState",value:function(e){var t={};if(null==e)for(var a=0;a<he.length;a++)t[he[a]]=null;else for(var n=0;n<he.length;n++)he[n]in this.props.user?t[he[n]]=this.props.user[he[n]]:t[he[n]]=null;return t}},{key:"handleUserTypeSelect",value:function(e){var t=this.state.userInfo;t.UserType=e,this.setState({userInfo:t})}},{key:"render",value:function(){return r.a.createElement("div",null,this.state.ready&&r.a.createElement("div",null,this.props.showTable_f&&r.a.createElement(w.a,{className:"rowVMarginSm "},r.a.createElement(S.a,null,r.a.createElement(L.a,{onClick:this.back,icon:"caret-left"},"Back"))),r.a.createElement(w.a,{className:"rowVMarginSm"},r.a.createElement(I.a,{size:"medium",title:"User Details"},this.modifyControls(),this.basicFeatures(),this.adminFeatures()))))}}]),t}(n.Component),me=function(e){function t(){var e,a;Object(h.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(m.a)(this,(e=Object(g.a)(t)).call.apply(e,[this].concat(r)))).state={user:null},a.componentDidMount=function(){ce.user().then(function(e){a.setState({user:e})})},a}return Object(y.a)(t,e),Object(f.a)(t,[{key:"render",value:function(){return r.a.createElement("div",null,this.state.user&&r.a.createElement(w.a,{className:"rowVMarginTopSm",gutter:16},r.a.createElement(S.a,{xs:{span:24,offset:0},sm:{span:22,offset:1},md:{span:18,offset:3},lg:{span:16,offset:4}},r.a.createElement(fe,{showTable_f:null,user:this.state.user,mode:"existing",refreshUsers:function(){}}))))}}]),t}(n.Component),ge=(a(190),a(120)),ye=[],ve=function(e){function t(){var e,a;Object(h.a)(this,t);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return(a=Object(m.a)(this,(e=Object(g.a)(t)).call.apply(e,[this].concat(o)))).populateUsers=function(){F.User.toArray(function(e){e.forEach(function(e){e.key=e.Id,e.name="".concat(e.FirstName," ").concat(e.LastName),e.permissionLevel=e.LocationType.charAt(0).toUpperCase()+e.LocationType.slice(1)}),ye=e.sort(function(e,t){try{var a=e.LastName.localeCompare(t.LastName);return 0===a?e.FirstName.localeCompare(t.FirstName):a}catch(n){return-1}}),a.setState({currentView:"table"})})},a.componentWillMount=function(){a.populateUsers()},a.state={showTable:!0,selectedUser:null,currentView:"loading"},a.columns=[{title:"Name",dataIndex:"name",key:"name",defaultSortOrder:"descend",sorter:function(e,t){return e.name.localeCompare(t.name,"en")}},{title:"Scope",dataIndex:"permissionLevel",filters:[{text:"Ward",value:"Ward"},{text:"Facility",value:"Facility"},{text:"LGA",value:"LGA"},{text:"State",value:"State"},{text:"National",value:"National"}],onFilter:function(e,t){return t.permissionLevel===e},filterMultiple:!0,key:"permissionLevel"},{title:"Location",dataIndex:"LocationName",key:"LocationName",defaultSortOrder:"descend",sorter:function(e,t){return e.LocationName.localeCompare(t.LocationName,"en")}},{title:"Action",key:"action",render:function(e,t){return r.a.createElement(L.a,{onClick:function(){a.editUser(t.key)}},"View")}}],a.editUser=function(e){var t=ye.find(function(t){return t.Id===e});a.setState({currentView:"existing",selectedUser:t})},a.showWhenCurrentViewIs=function(e,t){return a.state.currentView===e?t:"".concat(t," displayNone")},a.showHideTableClass=function(){return"table"===a.state.currentView?"":"displayNone"},a.showHideViewClass=function(){return"existing"===a.state.currentView?"":"displayNone"},a.showTable=function(){a.setState({currentView:"table"})},a.addUser=function(){a.setState({currentView:"new"})},a.tableHidden=function(){return"table"!==a.state.currentView},a.colStyle={xs:{span:24,offset:0},sm:{span:22,offset:1},md:{span:18,offset:3},lg:{span:16,offset:4}},a}return Object(y.a)(t,e),Object(f.a)(t,[{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement(w.a,{className:this.showWhenCurrentViewIs("loading","rowVMarginSm")},r.a.createElement(S.a,this.colStyle,r.a.createElement("div",{className:"spacing"},r.a.createElement(N.a,{size:"large"})))),r.a.createElement("div",{className:this.showWhenCurrentViewIs("table","")},r.a.createElement(w.a,{className:"rowVMarginTopSm",gutter:16},r.a.createElement(S.a,{className:"left",xs:{span:16,offset:0},sm:{span:14,offset:1},md:{span:10,offset:3},lg:{span:8,offset:4}}),r.a.createElement(S.a,{className:"right",span:8},r.a.createElement(L.a,{onClick:this.addUser,icon:"user-add",type:"primary"},"Add User"))),r.a.createElement(w.a,{className:"rowVMarginTopSm"},r.a.createElement(S.a,this.colStyle,r.a.createElement(ge.a,{dataSource:ye,columns:this.columns})))),"new"===this.state.currentView&&r.a.createElement(w.a,{className:"rowVMarginTopSm",gutter:16},r.a.createElement(S.a,this.colStyle,r.a.createElement(fe,{showTable_f:this.showTable,user:null,mode:"new",refreshUsers:this.populateUsers}))),"existing"===this.state.currentView&&r.a.createElement(w.a,{className:"rowVMarginTopSm",gutter:16},r.a.createElement(S.a,this.colStyle,r.a.createElement(fe,{showTable_f:this.showTable,user:this.state.selectedUser,mode:"existing",refreshUsers:this.populateUsers}))))}}]),t}(n.Component),be=(a(438),a(157)),Ee=function(e){function t(){var e,a;Object(h.a)(this,t);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return(a=Object(m.a)(this,(e=Object(g.a)(t)).call.apply(e,[this].concat(o)))).state={showProgress:!1,DataDownloads:[]},a.startDownload=function(){for(var e="https://essd-backend-dev.azurewebsites.net/api",t=[{dataName:"user",callback:function(e){return new Promise(function(t){F.User.clear().then(function(){F.User.bulkAdd(e.users).then(function(){t(!0)}).catch(function(e){console.log(e),t(!1)})})})},url:"".concat(e,"/users/getAllUsers/").concat(a.state.user.Id)},{dataName:"location",callback:function(e){return new Promise(function(t){Promise.all([F.State.clear(),F.LGA.clear(),F.Ward.clear(),F.Facility.clear()]).then(Promise.all([F.State.bulkAdd(e.State),F.LGA.bulkAdd(e.LGA),F.Ward.bulkAdd(e.Ward),F.Facility.bulkAdd(e.Facility)]).then(t(!0)).catch(t(!1))).catch(t(!1))})},url:"".concat(e,"/locationsHierarchy")},{dataName:"metric values",callback:function(e){return new Promise(function(t){Promise.all([F.Data.clear()]).then(Promise.all([F.Data.bulkAdd(e.Data)]).then(t(!0)).catch(t(!1))).catch(t(!1))})},url:"".concat(e,"/data/location?state=Zamfara&lga=Anka&ward=Bagega")},{dataName:"metric names",callback:function(e){return new Promise(function(t){Promise.all([F.Groups.clear(),F.Sets.clear(),F.Metrics.clear()]).then(Promise.all([F.Groups.bulkAdd(e.Groups),F.Sets.bulkAdd(e.Sets),F.Metrics.bulkAdd(e.Metrics)]).then(t(!0)).catch(t(!1))).catch(t(!1))})},url:"".concat(e,"/data/hierarchy")}],n=[],o=0;o<t.length;o++){var i=t[o];n.push(r.a.createElement(De,{key:o,dataName:i.dataName,url:i.url,callback:i.callback}))}if(a.state.downloadDashboard){var s="".concat(e,"/dashboard/").concat(a.state.user.Id);n.push(r.a.createElement(De,{key:n.length,dataName:"dashboard information",url:s,callback:function(e){return new Promise(function(t){var a=e.dashboard;F.Dashboard.clear().then(function(){if(a.hasOwnProperty("error"))t(!0);else{var e=JSON.parse(a.DashboardJson);F.Dashboard.bulkAdd(e.dashboards).then(function(){t(!0)})}})})}}))}else{var c="".concat(e,"/dashboard/updateDashboard"),l={method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({UserId:a.state.user.Id,DashboardJson:JSON.stringify(a.state.dashboardData)})};n.push(r.a.createElement(De,{key:n.length,dataName:"dashboard information",url:c,callback:function(e){return new Promise(function(e){e(!0)})},params:l}))}a.setState({DataDownloads:n,showProgress:!0})},a}return Object(y.a)(t,e),Object(f.a)(t,[{key:"componentDidMount",value:function(){var e=this;F.Dashboard.toArray().then(function(t){0===t.length?ce.user().then(function(t){e.setState({user:t,ready:!0,downloadDashboard:!0})}):ce.user().then(function(a){e.setState({user:a,ready:!0,downloadDashboard:!1,dashboardData:{dashboards:t}})})})}},{key:"render",value:function(){return r.a.createElement("div",{className:"center"},r.a.createElement(I.a,{className:"rowVMarginTopSm"},r.a.createElement(w.a,{className:"rowVMarginTopSm"},r.a.createElement(S.a,{xs:24,sm:{span:22,offset:1},md:{span:18,offset:2},lg:{span:16,offset:4},xl:{span:16,offset:4}},r.a.createElement("p",null,r.a.createElement(l.a,{type:"wifi"}),"\xa0 Please note: you must have an internet connection."),this.state.ready&&r.a.createElement(L.a,{type:"primary",onClick:this.startDownload},"Start Sync"))),r.a.createElement(w.a,null,r.a.createElement(S.a,{hidden:!this.state.showProgress,xs:{span:22,offset:1},sm:{span:20,offset:2},md:{span:12,offset:6},lg:{span:10,offset:7},xl:{span:8,offset:8}},r.a.createElement(be.a,{className:"rowVMarginTopSm"},this.state.DataDownloads)))))}}]),t}(n.Component),De=function(e){function t(){var e,a;Object(h.a)(this,t);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return(a=Object(m.a)(this,(e=Object(g.a)(t)).call.apply(e,[this].concat(o)))).state={pending:!0,failed:!1},a.Icon=function(){return!0===a.state.pending?a.pendingIcon:!0===a.state.failed?a.failedIcon:a.completeIcon},a.pendingIcon=r.a.createElement(l.a,{type:"sync",spin:!0}),a.completeIcon=r.a.createElement(l.a,{type:"check-circle",className:"override-background"}),a.failedIcon=r.a.createElement(l.a,{type:"close-circle"}),a.Message=function(){return!0===a.state.pending?a.pendingMessage:!0===a.state.failed?a.failedMessage:a.completeMessage},a.pendingMessage="Downloading ".concat(a.props.dataName," data"),a.failedMessage="Failed to download ".concat(a.props.dataName," data. Please try again later"),a.completeMessage="Successfully updated ".concat(a.props.dataName," data"),a.get=function(){var e=Object(p.a)(d.a.mark(function e(t,n,r){return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,r);case 2:e.sent.json().then(function(e){n(e).then(function(e){e?a.setState({pending:!1,failed:!1}):a.setState({pending:!1,failed:!0})})});case 4:case"end":return e.stop()}},e,this)}));return function(t,a,n){return e.apply(this,arguments)}}(),a}return Object(y.a)(t,e),Object(f.a)(t,[{key:"componentDidMount",value:function(){this.props.params?this.get(this.props.url,this.props.callback,this.props.params):this.get(this.props.url,this.props.callback)}},{key:"render",value:function(){return r.a.createElement(be.a.Item,{dot:this.Icon()},this.Message())}}]),t}(n.Component),we=Ee,Se=(a(441),function(e){function t(){var e,a;Object(h.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(m.a)(this,(e=Object(g.a)(t)).call.apply(e,[this].concat(r)))).state={location:a.props.initialLocation},a.componnentDidMount=function(){a.setState({location:a.props.initialLocation})},a.notifyParent=function(e){void 0!==a.props.parentHandler&&null!==a.props.parentHandler&&a.props.parentHandler(a.state.location,e)},a.updateLocation=function(e){a.setState({location:e})},a.saveLocation=function(){a.notifyParent(!0)},a.cancelLocation=function(){a.notifyParent(!1)},a}return Object(y.a)(t,e),Object(f.a)(t,[{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement(Q,{parentHandler:this.updateLocation,showLocation:!1,initialLocation:{Id:"1215",Type:"Facility"}}),r.a.createElement(W.a,null),r.a.createElement(w.a,null,r.a.createElement(S.a,{span:12}," ",r.a.createElement(L.a,{type:"primary",onClick:this.saveLocation},"Add")),r.a.createElement(S.a,{className:"right",span:12}," ",r.a.createElement(L.a,{onClick:this.cancelLocation},"Cancel"))))}}]),t}(n.Component)),Le=function(e){function t(){var e,a;Object(h.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(m.a)(this,(e=Object(g.a)(t)).call.apply(e,[this].concat(r)))).state={metricData:{GroupValue:"1191|Facility Attendance|Group",SetValue:"-3-1191|All Facility Attendance (Distribution)|Group",MetricValue:""},initLoading:!1,loading:!1,locationData:{},showTable:!0,selectedUser:null,dataLoaded:!1,currentView:"table",selectedLocation:null,addingLocation:!1,Dates:{StartDate:new Date("2015-01-01T00:00:00.000Z"),EndDate:new Date("2019-01-01T00:00:00.000Z")},arr:null,dataForSingleLocation:[],dataForAllLocations:[],showGraph:!1,graphType:"Group",data:null},a.generateGraph=function(){var e=[];for(var t in a.state.locationData)e.push(a.state.locationData[t]);"Metric"===a.state.metricData.Type?a.createMetricGraph(e):"Set"===a.state.metricData.Type?a.createSetGraph(e):a.state.metricData.Type,a.setState({currentView:"graph"})},a.formatDate=function(e){return"".concat(e.getUTCFullYear(),"-").concat(("0"+(e.getUTCMonth()+1)).slice(-2),"-").concat(("0"+e.getUTCDate()).slice(-2),"T00:00:00.000Z")},a.createMetricGraph=function(e){var t={dataForAllLocations:[]};a.forEachPromise(e,a.getDataPromiseByLocation,t).then(function(){console.log(a.state.metricData.Name),a.setState({showGraph:!0,currentView:"graph",graphType:"Set",data:{name:a.state.metricData.Name,data:t.dataForAllLocations}})})},a.createSetGraph=function(e){var t=[],n=[];a.getMetricsPromise(a.state.metricData.Id).then(function(r){var o={dataForAllLocations:t,metrics:r,locations:n};a.forEachPromise(e,a.getLocationPromise,o).then(function(){console.log(o.locations),console.log(o.dataForAllLocations),a.setState({showGraph:!0,currentView:"graph",graphType:"Group",data:{data:o.dataForAllLocations,legendTitles:o.locations}}),console.log("donezo")})})},a.forEachPromise=function(e,t,a){return e.reduce(function(e,n){return e.then(function(){return t(n,a)})},Promise.resolve())},a.getLocationPromise=function(e,t){return new Promise(function(n,r){var o={location:e,dataForAllLocations:t.dataForAllLocations,dataForSingleLocation:[]};a.forEachPromise(t.metrics,a.getDataPromise,o).then(function(){t.dataForAllLocations.push(o.dataForSingleLocation),t.locations.push(o.location.Name)}).then(function(){n(!0)})})},a.getMetricsPromise=function(e){return F.Metrics.where("parentId").equalsIgnoreCase(e).toArray()},a.getDataPromise=function(e,t){return new Promise(function(n,r){F.Data.where(["FacilityId","MetricId","Time"]).between([t.location.Id,e.Id,a.formatDate(a.state.Dates.StartDate)],[t.location.Id,e.Id,a.formatDate(a.state.Dates.EndDate)],!0,!0).toArray().then(function(a){var r=0;a.forEach(function(e){r+=parseInt(e.Value)}),t.dataForSingleLocation.push({Value:r,Metric:e.Name}),console.log("Adding Data from current Metric: "+e.Id+", value: "+r),n(!0)})})},a.getDataPromiseByLocation=function(e,t){return new Promise(function(n,r){F.Data.where(["FacilityId","MetricId","Time"]).between([e.Id,a.state.metricData.Id,a.formatDate(a.state.Dates.StartDate)],[e.Id,a.state.metricData.Id,a.formatDate(a.state.Dates.EndDate)],!0,!0).toArray().then(function(a){var r=0;a.forEach(function(e){r+=parseInt(e.Value)}),t.dataForAllLocations.push({Value:r,Metric:e.Name}),console.log("Adding Data from current Location: "+e.Id+", value: "+r),n(!0)})})},a.saveGraph=function(){F.Dashboard.toCollection().last().then(function(e){var t=0;e&&(t=e.Id+1);var n={Id:t,Title:"Compare - "+a.state.metricData.Name,Locations:a.state.locationData,Dates:a.state.Dates,Data:a.state.data,MetricData:a.state.metricData,Compare:!0,GraphType:a.state.graphType};F.Dashboard.put(n).then(function(){console.log(n),T.a.success("Successfully saved to dashboard.")})})},a.updateRawData=function(e){a.setState({RawData:e})},a.updateData=function(e){a.setState({metricData:e})},a.updateLocation=function(e,t){if(t){var n=a.state.locationData;a.state.addingLocation||delete n[a.state.selectedLocation.Type+"-"+a.state.selectedLocation.Id],n[e.Type+"-"+e.Id]=e,a.setState({selectedLocation:e}),T.a.success("Location Added"),a.setState({locationData:n})}a.setState({currentView:"table"})},a.addLocation=function(){a.setState({addingLocation:!0,currentView:"existing",selectedLocation:null})},a.deleteLocation=function(e){var t=a.state.locationData;delete t[e.Type+"-"+e.Id],a.setState({locationData:t,selectedLocation:null,currentView:"table"}),T.a.success("Location Deleted")},a.editLocation=function(e){a.setState({addingLocation:!1,selectedLocation:e,currentView:"existing"})},a.showTable=function(){a.setState({currentView:"table"})},a.showHideTableClass=function(){return"table"===a.state.currentView?"":"displayNone"},a.updateDates=function(e){a.setState({Dates:e})},a}return Object(y.a)(t,e),Object(f.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement("div",null,"table"===this.state.currentView&&r.a.createElement("div",{className:"center"},r.a.createElement(w.a,{className:"rowVMarginSm rowVMarginTopSm",gutter:16},r.a.createElement(S.a,{xs:{span:24,offset:0},sm:{span:22,offset:1},md:{span:18,offset:3},lg:{span:16,offset:4}},r.a.createElement(I.a,{className:"left",size:"medium",title:"Analyze Data"},r.a.createElement("h4",null,"Select Data"),r.a.createElement(K,{parentHandler:this.updateData,initialData:this.state.metricData}),r.a.createElement(W.a,null),r.a.createElement("h4",null,"Select Dates"),r.a.createElement(re,{parentHandler:this.updateDates,initialData:{Dates:this.state.Dates}}),r.a.createElement(W.a,null),r.a.createElement("h4",null,"Select Locations"),r.a.createElement("div",{className:"center"},r.a.createElement(L.a,{block:!0,onClick:this.addLocation},"Add Location")),this.state.locationData&&r.a.createElement(k.a,{itemLayout:"horizontal",size:"large",pagination:{onChange:function(e){console.log(e)},pageSize:4},dataSource:Object.values(this.state.locationData),renderItem:function(t){return r.a.createElement(k.a.Item,{key:t.facility,actions:[r.a.createElement(L.a,{onClick:function(){e.editLocation(t)},style:{marginLeft:8}},"Edit ",r.a.createElement(l.a,{type:"edit"})),r.a.createElement(L.a,{onClick:function(){e.deleteLocation(t)},style:{marginLeft:8}},"Delete ",r.a.createElement(l.a,{type:"delete"}))]},r.a.createElement(k.a.Item.Meta,{title:r.a.createElement("a",{href:"https://ant.design"},t.Name),description:"Location Type: "+t.Type}))}}),r.a.createElement(W.a,null),r.a.createElement(L.a,{type:"primary",block:!0,onClick:this.generateGraph},"Generate Graph"))))),"existing"!==this.state.currentView?null:r.a.createElement("div",{className:""},r.a.createElement(w.a,{className:"",gutter:16},r.a.createElement(S.a,{xs:{span:24,offset:0},sm:{span:22,offset:1},md:{span:18,offset:3},lg:{span:16,offset:4}},r.a.createElement(I.a,{className:"left",size:"medium",title:"Select Location"},r.a.createElement(Se,{parentHandler:this.updateLocation,initialLocation:this.state.selectedLocation}))))),"graph"!==this.state.currentView?null:r.a.createElement("div",{className:""},r.a.createElement(I.a,{className:"left",size:"medium",title:"Graph"},r.a.createElement(L.a,{onClick:this.showTable},"Back"),r.a.createElement(W.a,null),r.a.createElement(L.a,{onClick:this.saveGraph},"Save Graph ",r.a.createElement(l.a,{type:"save"})),r.a.createElement(G,{type:this.state.graphType,show:this.state.showGraph,data:this.state.data}))))}}]),t}(n.Component),Me=(a(443),a(204)),Ie=[{title:"Location",dataIndex:"Name",key:"Location",defaultSortOrder:"ascend",sorter:function(e,t){return e.Name.localeCompare(t.Name,"en")}},{title:"Data Points",dataIndex:"MetricsReportedInLastYear",key:"Reports",sorter:function(e,t){return e.MetricsReportedInLastYear-t.MetricsReportedInLastYear}},{title:"Percent",dataIndex:"Score",key:"Score",sorter:function(e,t){return e.MetricsReportedInLastYear-t.MetricsReportedInLastYear}}],ke=function(e){function t(){var e,a;Object(h.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(m.a)(this,(e=Object(g.a)(t)).call.apply(e,[this].concat(r)))).state={ready:!1},a.setLocation=function(e){a.setState({location:e}),"Ward"===e.Type&&a.getQualityOfData(e.Id)},a.getQualityOfData=function(e){F.Facility.where({parentId:e}).toArray().then(function(e){e.forEach(function(e){e.Score="".concat((e.MetricsReportedInLastYear/6144*100).toFixed(0),"%"),e.key=e.Id}),a.setState({data:e,ready:!0})})},a}return Object(y.a)(t,e),Object(f.a)(t,[{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement(Me.a,{message:"This tool reports the amount of data reported in the last year by each facility in a given ward. Use this to identify the facilities that need the most support in the monthly data collection process.",banner:!0,closable:!0}),r.a.createElement(w.a,{className:"rowVMarginTopSm",gutter:16},r.a.createElement(S.a,{xs:{span:24,offset:0},sm:{span:22,offset:1},md:{span:18,offset:3},lg:{span:16,offset:4}},r.a.createElement(I.a,{size:"medium",title:"Select Ward"},r.a.createElement(Q,{parentHandler:this.setLocation,initialLocation:{Type:"Ward",Id:"386"}})))),r.a.createElement(w.a,{className:"rowVMarginTopSm",gutter:16},r.a.createElement(S.a,{xs:{span:24,offset:0},sm:{span:22,offset:1},md:{span:18,offset:3},lg:{span:16,offset:4}},this.state.ready&&r.a.createElement(ge.a,{dataSource:this.state.data,columns:Ie}))))}}]),t}(n.Component),Te=(a(446),v.a.Header),Oe=v.a.Footer,Ce=v.a.Content,Ne={"/":"Dashboard","/account":"Account","/dashboard":"Dashboard","/analysis":"Analysis","/users":"Users","/sync":"Synchronize Data","/health":"Data Health"},Ae=function(e){function t(){var e,a;Object(h.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(m.a)(this,(e=Object(g.a)(t)).call.apply(e,[this].concat(r)))).getTitle=function(){var e=window.location.pathname;return e in Ne?Ne[e]:"Hmm...this page has no title"},a.state={drawerOpen:!1,user:null},a.openDrawer=function(){a.setState({drawerOpen:!0})},a.closeDrawer=function(){a.setState({drawerOpen:!1})},a.updateDrawer=function(){return ce.user().then(function(e){a.setState({user:e})})},a.logout=Object(p.a)(d.a.mark(function e(){return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a.setState({user:null}),e.next=3,ce.logout();case 3:case"end":return e.stop()}},e,this)})),a}return Object(y.a)(t,e),Object(f.a)(t,[{key:"componentWillMount",value:function(){var e=this;ce.user().then(function(t){e.setState({user:t})})}},{key:"render",value:function(){var e=this;return r.a.createElement(b.a,null,r.a.createElement(v.a,null,null==this.state.user?"":r.a.createElement(s.a,{title:"Menu",placement:"left",closable:!0,onClose:this.closeDrawer,visible:this.state.drawerOpen},r.a.createElement(c.a,{onClick:this.closeDrawer},r.a.createElement(c.a.Item,{key:"2"},r.a.createElement(E.a,{to:"/dashboard"},r.a.createElement(l.a,{type:"area-chart"}),"Dashboard")),r.a.createElement(c.a.Item,{key:"3"},r.a.createElement(E.a,{to:"/analysis"},r.a.createElement(l.a,{type:"stock"}),"Analysis")),r.a.createElement(c.a.Item,{key:"4"},r.a.createElement(E.a,{to:"/health"},r.a.createElement(l.a,{type:"heart"}),"Data Health")),r.a.createElement(c.a.Item,{key:"5"},r.a.createElement(E.a,{to:"/account"},r.a.createElement(l.a,{type:"user"}),"Account")),null!==this.state.user&&"admin"!==this.state.user.UserType?"":r.a.createElement(c.a.Item,{key:"6"},r.a.createElement(E.a,{to:"/users"},r.a.createElement(l.a,{type:"team"}),"Users")),r.a.createElement(c.a.Item,{key:"7"},r.a.createElement(E.a,{to:"/sync"},r.a.createElement(l.a,{type:"sync"}),"Synchronize Data")),null==this.state.user?"":r.a.createElement(c.a.Item,{key:"8",onClick:this.logout},r.a.createElement(E.a,{to:"/"},r.a.createElement(l.a,{type:"poweroff"}),"Logout")))),r.a.createElement(Te,{style:{padding:0}},r.a.createElement(M,{drawerOpen:this.state.drawerOpen,openDrawer_f:this.openDrawer,title:this.getTitle()})),r.a.createElement(Ce,{className:"min-height-wrapper gutterOverflowMask"},r.a.createElement(D.a,{exact:!0,path:"/",render:function(t){return r.a.createElement(pe,Object.assign({},t,{updateDrawer:e.updateDrawer}))}}),r.a.createElement(D.a,{path:"/dashboard",component:ie}),r.a.createElement(D.a,{path:"/analysis",component:Le}),r.a.createElement(D.a,{path:"/account",component:me}),r.a.createElement(D.a,{path:"/users",component:ve}),r.a.createElement(D.a,{path:"/sync",component:we}),r.a.createElement(D.a,{path:"/health",component:ke})),r.a.createElement(Oe,null,r.a.createElement("p",null,"ESSD is an ",r.a.createElement("a",{href:"https://github.com/Epidemic-Surveillance-System-Dashboard/",target:"_blank",rel:"noopener noreferrer"},"open source capstone project")," by Aayush Bahendwar, Jackie Ngo, Laban Lin, and Patrick Lee."),r.a.createElement("p",null,"It is built with components by",r.a.createElement("a",{href:"https://ant.design/",target:"_blank",rel:"noopener noreferrer"}," Ant Financial "),"and powered by",r.a.createElement("a",{href:"https://reactjs.org/",target:"_blank",rel:"noopener noreferrer"}," React"),"."))))}}]),t}(n.Component),je=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function Ve(e,t){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var a=e.installing;null!=a&&(a.onstatechange=function(){"installed"===a.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See http://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}}).catch(function(e){console.error("Error during service worker registration:",e)})}i.a.render(r.a.createElement(Ae,null),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",function(){var t="".concat("","/service-worker.js");je?(function(e,t){fetch(e).then(function(a){var n=a.headers.get("content-type");404===a.status||null!=n&&-1===n.indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):Ve(e,t)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(t,e),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit http://bit.ly/CRA-PWA")})):Ve(t,e)})}}()}},[[209,2,1]]]);
//# sourceMappingURL=main.5845a784.chunk.js.map